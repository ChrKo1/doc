---
title: Reading data into FLR 
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  github_document
tags:
license: Creative Commons CC-BY SA
---
 
```{r, ini, echo=FALSE, results='hide', message=FALSE}
# This chunk set the document environment, so it is hidden
library(knitr)
opts_chunk$set(fig.align='center',
  message=FALSE, warning=FALSE, echo=TRUE, cache=FALSE)
options(width=50)
set.seed(1423)
```

This tutorial details methods for reading various formats of data into R for generating the FLStock() object class.

## Required packages




To follow this tutorial you should have installed the following packages:

- CRAN: [ggplot2](https://cran.r-project.org/web/packages/ggplot2/index.html)
- FLR: [FLCore](http://www.flr-project.org/FLCore/), [ggplotFL](http://www.flr-project.org/ggplotFL/)

You can do so as follows,

```{r, eval=FALSE}
install.packages(c("ggplot2"))
install.packages(c("ggplotFL"), repos="http://flr-project.org/R")
```

```{r, pkgs}
# This chunk loads all necessary packages, trims pkg messages
library(FLCore)
library(ggplotFL)
```

# SECTION

PD

## SubSECTION : Reading files (csv, dat, ...) - YV

Fisheries data are generally stored in different format (cvs, excel, SAS...). R provides tools to read and import data from simple text files to more advanced SAS files or databases.
https://www.datacamp.com/community/tutorials/importing-data-r-part-two#gs.kNzBd5k is a nice tutorial to quickly import data into R.

Your data are stored in a folder in your computer or a server. You have to tell R what is the path to the data.
You can check the working directory already active in your R session using the command getwd(). 
To set the working directory use setwd("directory name"). Case is important, use // or \ for separating folders and directories in Windows.


This tutorial will give some exemples but regardless the format, the different steps are:
- Finding the right function to import data into R
- Reshaping the data as a matix 
- creating an FLQuant object

### importing files into R (exemple of csv file)

There is many ways of reading csv files. 
`read.table` with 'header', 'sep', 'dec' and 'row.names' options will allow you reading all .csv and .txt files

The `read.csv` or `read.csv2` function are very useful to read csv files. 

``` {r }
catch.n <- read.csv("src/Data/catch_numbers.csv",row=1)
```

We have read in the data as a data.frame

``` {r }
class(catch.n)
```

The data are now in your R environment, before creating a **FLQuant** object, you need to make sure it is consistant with the type of object and formating that is needed to run the `FLQuant()` function. To get information on the structure and format needed type ?FLQuant in your R Console.


## SUbsection : Reshaping data as a matrix - YV

FLQuant accept 'vector', 'array' or 'matrix'. 
We can convert the object catch.n to a matrix

``` {r }
catch.n.matrix <- as.matrix(catch.n)
catch.n.matrix[,1:8]
```

A `FLQuant` object is made of six dimensions. The name of the first dimension can be altered by the user from its default, quant. This could typically be age or length for data related to natural populations. The only name not accepted is 'cohort', as data structured along cohort should be stored using the `FLCohort` class instead. Other dimensions are always names as follows: year, for the calendar year of the datapoint; unit, for any kind of division of the population, e.g. by sex; season, for any temporal strata shorter than year; area, for any kind of spatial stratification; and iter, for replicates obtained through bootstrap, simulation or Bayesian analysis.

When importing catch number for exemple, the input object needs to be formated as such: age or length in the first dimension and years in the seconde dimension. If the object is not formatted in the right way, you can use the `reshape()` function.


## Subection :  Making an FLQuant object - PD



We need to specify the dimnames
``` {r }
catch.n.flq <- FLQuant(catch.n.matrix, dimnames=list(age=1:7, year = 1957:2011))
catch.n.flq[,1:8]

```

## Reading common fisheries data formats 

FLCore contains functions for reading in fish stock data in common pre-defined formats. To read a single variable (e.g. numbers-at-age, maturity-at-age) from the **Lowestoft VPA** format you use the `readVPA` function. The following example reads the catch numbers-at-age for herring:

```{r, readVPA}
catch.n <- readVPAFile(file.path('src','Data','her-irlw',"canum.txt"))
class(catch.n)
```
This can be repeated for each of the data files. 

Alternatively, if you have the full information for a stock in the **Lowestoft VPA**, **Adapt**, **CSA** or **ICA** format you can read in together using the `readFLStock` function. Here, you point the function to the index file, with all other files in the same directory:

```{r, readFLStock}
her <- readFLStock(file.path('src','Data','her-irlw','index.txt'))
class(her)
```
Which we can see correctly formats the data as an `FLStock` object.

```{r, readFLStock2}
summary(her)
```
Note that the units for the slots have not been set. We will deal with this in the section below.

In addition, this object only contains the input data for the stock assessment, not any estimated values (e.g. harvest rates, stock abundances). You can add these to the object as follows:

```{r, Add values}
her@stock.n <- readVPAFile(file.path('src','Data','her-irlw',"n.txt"))
```



## Subsection : Description, units, ranges etc.. - PD

# References


# More information

* You can submit bug reports, questions or suggestions on this tutorial at <https://github.com/flr/doc/issues>.
* Or send a pull request to <https://github.com/flr/doc/>
* For more information on the FLR Project for Quantitative Fisheries Science in R, visit the FLR webpage, <http://flr-project.org>.

## Software Versions

* `r version$version.string`
* FLCore: `r packageVersion('FLCore')`
* ggplotFL: `r packageVersion('ggplotFL')`
* ggplot2: `r packageVersion('ggplot2')`
* **Compiled**: `r date()`

## License

This document is licensed under the [Creative Commons Attribution-ShareAlike 4.0 International](https://creativecommons.org/licenses/by-sa/4.0) license.

## Author information

**Iago MOSQUEIRA**. European Commission Joint Research Centre (JRC), Institute for the Protection and Security of the Citizen (IPSC), Maritime Affairs Unit, Via E. Fermi 2749, 21027 Ispra VA, Italy. <https://ec.europa.eu/jrc/>
