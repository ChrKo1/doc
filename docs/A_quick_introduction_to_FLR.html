<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>A quick introduction to FLR</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-1.1/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-1.1/highlight.js"></script>
<link href="site_libs/font-awesome-4.5.0/css/font-awesome.min.css" rel="stylesheet" />

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}

.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->






<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html"></a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="http://flr-project.org">
    <span class="fa fa-home"></span>
     
    FLR
  </a>
</li>
<li>
  <a href="index.html">
    <span class="fa fa-info"></span>
     
    Home
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-gear"></span>
     
    Introduction
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="A_quick_introduction_to_FLR.html">A quick intro</a>
    </li>
    <li>
      <a href="B.html">Page B</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-gear"></span>
     
    Input
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="A.html">Page A</a>
    </li>
    <li>
      <a href="B.html">Page B</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-gear"></span>
     
    Visualization
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="A.html">Page A</a>
    </li>
    <li>
      <a href="B.html">Page B</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-gear"></span>
     
    Modelling
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="A.html">Page A</a>
    </li>
    <li>
      <a href="B.html">Page B</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-gear"></span>
     
    Advice
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="A.html">Page A</a>
    </li>
    <li>
      <a href="B.html">Page B</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-gear"></span>
     
    MSE
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="A.html">Page A</a>
    </li>
    <li>
      <a href="B.html">Page B</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://example.com">
    <span class="fa fa-question fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">A quick introduction to FLR</h1>
<h4 class="date"><em>26 agosto, 2017</em></h4>

</div>


<p>The Fisheries Library in R (FLR) is a collection of tools for quantitative fisheries science, developed in the R language, that facilitates the construction of bio-economic simulation models of fisheries systems as well as the application of a wide range of quantitative analysis.</p>
<p>FLR builds on the powerful R environment and syntax to create a <a href="https://en.wikipedia.org/wiki/Domain-specific_language">domain-specific language</a> for the quantitative analysis of the expected risks and impacts of fisheries management decisions. The classes and methods in FLR consider uncertainty an integral part of our knowledge of fisheries systems.</p>
<div id="required-packages" class="section level2">
<h2>Required packages</h2>
<p>To follow this tutorial you should have installed the following packages:</p>
<ul>
<li>CRAN: latticeExtra, gridExtra, ggplot2</li>
<li>FLR: <a href="http://www.flr-project.org/FLCore/">FLCore</a>, <a href="http://www.flr-project.org/FLa4a/">FLa4a</a>, <a href="http://www.flr-project.org/ggplotFL/">ggplotFL</a>, <a href="http://www.flr-project.org/FLa4a/">FLa4a</a></li>
</ul>
<p>You can do so as follows:</p>
<pre class="r"><code>install.packages(c(&quot;latticeExtra&quot;, &quot;gridExtra&quot;, &quot;ggplot2&quot;, &quot;triangle&quot;, &quot;copula&quot;, &quot;coda&quot;, &quot;mgcv&quot;))
install.packages(c(&quot;FLCore&quot;, &quot;ggplotFL&quot;, &quot;FLa4a&quot;), repos=&quot;http://flr-project.org/R&quot;)</code></pre>
</div>
<div id="classes-and-methods" class="section level1">
<h1>Classes and methods</h1>
<p>The <em>FLCore</em> package defines a series of data structures that represent different elements of the fishery system. These structures are defined using R’s S4 class system, while functions to operate on those classes are defined as methods. In this way function call (e.g. <code>plot()</code>) can be used on different classes and their behaviour is consistent with the class structure and content. For further information on the S4 class system, please look at the <a href="https://stat.ethz.ch/R-manual/R-patched/library/methods/html/Introduction.html">introductory text on the <strong>methods</strong> package</a>.</p>
<div id="flquant" class="section level2">
<h2>FLQuant</h2>
<p>The <a href="http://www.flr-project.org/FLCore/reference/FLQuant.html">FLQuant</a> class is the basic data structure for <strong>FLR</strong>, and it is in essence a 6D array on which data and outputs can be stored, structured along dimensions related to time, space, age or length, etc. It is also able to keep track of the units of measurement employed, as a simple character vector, although various operations on these objects are aware of the units of measurements contained in them.</p>
<p>We will be creating an altering <em>FLQuant</em> objects as we go along, but we can long briefly at some basic operations, as the syntax will then be used in other classes in <em>FLR</em>.</p>
<p>Let’s first load the necessary packages in our session. The <strong>FLCore</strong> paxckage</p>
<pre class="r"><code>library(FLCore)
library(ggplotFL)</code></pre>
<p>As it is the case for R classes, for example <em>data.frame</em>, classes in <em>FLR</em> can be constructed using a constructor method with the same name as the class, in this case <code>FLQuant()</code>.</p>
<pre class="r"><code>FLQuant(1:10)</code></pre>
<pre><code>An object of class &quot;FLQuant&quot;
An object of class &quot;FLQuant&quot;
, , unit = unique, season = all, area = unique

     year
quant 1  2  3  4  5  6  7  8  9  10
  all  1  2  3  4  5  6  7  8  9 10

units:  NA </code></pre>
<p>The <em>FLQuant</em> constructor can take a variety of inputs, like a vector, a matrix or an array, and also allows you to specify a nuber of arguments. We will only look now at three of them, <code>units</code> for the units of measurement, <code>quant</code> for the name of the first dimension, and <code>dimnames</code> for the dimension names of the object. For example, to construct an object holding (random) data in tonnes on catches for ages 1 to 4, over a period of 6 years, one could call</p>
<pre class="r"><code>flq &lt;- FLQuant(rlnorm(60), dimnames=list(age=1:4, year=2012:2017), units=&quot;t&quot;)

flq</code></pre>
<pre><code>An object of class &quot;FLQuant&quot;
An object of class &quot;FLQuant&quot;
, , unit = unique, season = all, area = unique

   year
age 2012    2013    2014    2015    2016    2017   
  1 0.60352 0.97440 0.99065 1.68515 1.36443 5.05653
  2 1.93833 2.09946 3.13919 0.84972 0.53418 0.69980
  3 0.24826 1.51710 5.28007 0.61229 0.59522 1.19544
  4 3.14748 6.16351 1.06234 0.93561 1.43151 0.81529

units:  t </code></pre>
<p>The object has six dimensions, although some of them (<code>unit</code>, <code>season</code>, <code>area</code> and <code>iter</code>) ar not used in this case. We can inspect the object in various ways</p>
<pre class="r"><code># A summary of structure and data
summary(flq)</code></pre>
<pre><code>An object of class &quot;FLQuant&quot; with:
dim  :  4 6 1 1 1 1 
quant:  age 
units:  t 

Min    :  0.2483 
1st Qu.:  0.7864 
Mean   :  1.789 
Median :  1.129 
3rd Qu.:  1.979 
Max    :  6.164 
NAs    :  0 %</code></pre>
<pre class="r"><code># dimnames
dimnames(flq)</code></pre>
<pre><code>$age
[1] &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;4&quot;

$year
[1] &quot;2012&quot; &quot;2013&quot; &quot;2014&quot; &quot;2015&quot; &quot;2016&quot; &quot;2017&quot;

$unit
[1] &quot;unique&quot;

$season
[1] &quot;all&quot;

$area
[1] &quot;unique&quot;

$iter
[1] &quot;1&quot;</code></pre>
<pre class="r"><code># dims
dim(flq)</code></pre>
<pre><code>[1] 4 6 1 1 1 1</code></pre>
<pre class="r"><code># units
units(flq)</code></pre>
<pre><code>[1] &quot;t&quot;</code></pre>
<p>It can be also subset and modified</p>
<pre class="r"><code># Extract first year
flq[, 1]</code></pre>
<pre><code>An object of class &quot;FLQuant&quot;
An object of class &quot;FLQuant&quot;
, , unit = unique, season = all, area = unique

   year
age 2012   
  1 0.60352
  2 1.93833
  3 0.24826
  4 3.14748

units:  t </code></pre>
<pre class="r"><code># Extract year 2013
flq[, &quot;2013&quot;]</code></pre>
<pre><code>An object of class &quot;FLQuant&quot;
An object of class &quot;FLQuant&quot;
, , unit = unique, season = all, area = unique

   year
age 2013  
  1 0.9744
  2 2.0995
  3 1.5171
  4 6.1635

units:  t </code></pre>
<pre class="r"><code># Set catches on age 1 to zero
flq[1,] &lt;- 0
flq</code></pre>
<pre><code>An object of class &quot;FLQuant&quot;
An object of class &quot;FLQuant&quot;
, , unit = unique, season = all, area = unique

   year
age 2012    2013    2014    2015    2016    2017   
  1 0.00000 0.00000 0.00000 0.00000 0.00000 0.00000
  2 1.93833 2.09946 3.13919 0.84972 0.53418 0.69980
  3 0.24826 1.51710 5.28007 0.61229 0.59522 1.19544
  4 3.14748 6.16351 1.06234 0.93561 1.43151 0.81529

units:  t </code></pre>
<p>as it can be used in many operations</p>
<pre class="r"><code># Product with scalar
flq * 10</code></pre>
<pre><code>An object of class &quot;FLQuant&quot;
An object of class &quot;FLQuant&quot;
, , unit = unique, season = all, area = unique

   year
age 2012    2013    2014    2015    2016    2017   
  1  0.0000  0.0000  0.0000  0.0000  0.0000  0.0000
  2 19.3833 20.9946 31.3919  8.4972  5.3418  6.9980
  3  2.4826 15.1710 52.8007  6.1229  5.9522 11.9544
  4 31.4748 61.6351 10.6234  9.3561 14.3151  8.1529

units:  t </code></pre>
<pre class="r"><code># Addition with another FLQuant
flq + (flq * 0.20)</code></pre>
<pre><code>An object of class &quot;FLQuant&quot;
An object of class &quot;FLQuant&quot;
, , unit = unique, season = all, area = unique

   year
age 2012    2013    2014    2015    2016    2017   
  1 0.00000 0.00000 0.00000 0.00000 0.00000 0.00000
  2 2.32600 2.51935 3.76703 1.01966 0.64102 0.83976
  3 0.29791 1.82052 6.33608 0.73475 0.71427 1.43453
  4 3.77698 7.39621 1.27480 1.12273 1.71781 0.97834

units:  t </code></pre>
<pre class="r"><code># Sum along years
yearSums(flq)</code></pre>
<pre><code>An object of class &quot;FLQuant&quot;
An object of class &quot;FLQuant&quot;
, , unit = unique, season = all, area = unique

   year
age 1      
  1  0.0000
  2  9.2607
  3  9.4484
  4 13.5557

units:  t </code></pre>
<div id="more-information" class="section level3">
<h3>More information</h3>
<p>To learn more about the class, check the <a href="http://www.flr-project.org/FLCore/reference/FLQuant.html">FLQuant help page</a>.</p>
</div>
</div>
</div>
<div id="loading-your-data" class="section level1">
<h1>Loading your data</h1>
<p>The first step in an analysis is to get the relevant data into the system. We will need to construct objects of certain <strong>FLR</strong> classes, but first data is loaded into the R session using any of the tools available in the language: <code>read.csv</code> for CSV files, <code>readVPA</code> and others for fisheries legacy file formats, …</p>
<p>In this example we will create an object of class <em>FLStock</em>, a representation of both inputs and outputs involved in fitting a stock assessment model, from a CSV file containing a table with five columns:</p>
<ul>
<li><em>slot</em>, the name of the input quantity, in this case either landings at age, <em>landings.n</em>, weight-at-age in the landings, <em>landings.wt</em>, and the same quantitieds for discards, <em>discards.n</em> and <em>discards.wt</em>.</li>
<li><em>age</em> and <em>year</em></li>
<li><em>data</em>, the numeric values themselves.</li>
<li><em>units</em>, a character string for the units of measurement employed: <em>kg</em> and <em>1000</em> in this case for kilograms and thousands.</li>
</ul>
<p>The file is downloaded into a temporary folder, and uncompressed. Simply change the value of <code>dir</code> to save the file in another folder.</p>
<pre class="r"><code>dir &lt;- tempdir()
download.file(&quot;http://www.flr-project.org/doc/src/ple4.csv.zip&quot;, file.path(dir, &quot;ple4.csv.zip&quot;))
unzip(file.path(dir, &quot;ple4.csv.zip&quot;), exdir=dir)</code></pre>
<p>The CSV file can now be loaded as a <code>data.frame</code> using <code>read.csv</code> and inspected</p>
<pre class="r"><code>dat &lt;- read.csv(file.path(dir, &quot;ple4.csv&quot;))
head(dat)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">slot</th>
<th align="right">age</th>
<th align="right">year</th>
<th align="right">data</th>
<th align="left">units</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">discards.n</td>
<td align="right">1</td>
<td align="right">1957</td>
<td align="right">32356</td>
<td align="left">1000</td>
</tr>
<tr class="even">
<td align="left">discards.n</td>
<td align="right">2</td>
<td align="right">1957</td>
<td align="right">45596</td>
<td align="left">1000</td>
</tr>
<tr class="odd">
<td align="left">discards.n</td>
<td align="right">3</td>
<td align="right">1957</td>
<td align="right">9220</td>
<td align="left">1000</td>
</tr>
<tr class="even">
<td align="left">discards.n</td>
<td align="right">4</td>
<td align="right">1957</td>
<td align="right">909</td>
<td align="left">1000</td>
</tr>
<tr class="odd">
<td align="left">discards.n</td>
<td align="right">5</td>
<td align="right">1957</td>
<td align="right">961</td>
<td align="left">1000</td>
</tr>
<tr class="even">
<td align="left">discards.n</td>
<td align="right">6</td>
<td align="right">1957</td>
<td align="right">25</td>
<td align="left">1000</td>
</tr>
</tbody>
</table>
<p>This data.frame contains the time series of landings and discards at age, in thousands, and the corresponding mean weights-at-age, in kg, for <a href="http://standardgraphs.ices.dk/ViewCharts.aspx?key=8980">North Sea plaice</a> (<em>Pleuronectes platessa</em>, ICES ple.27.420).</p>
<p>We can create an object to store the landings-at-age data by subsetting it from the <em>data.frame</em></p>
<pre class="r"><code>landn &lt;- subset(dat, slot==&quot;landings.n&quot;, select=-slot)</code></pre>
<p>and then convert into an <em>FLQuant</em> using</p>
<pre class="r"><code>landsn &lt;- as.FLQuant(landn)</code></pre>
<p>The object can now be inspected and plotted using the FLR-defined methods</p>
<pre class="r"><code>summary(landsn)</code></pre>
<pre><code>An object of class &quot;FLQuant&quot; with:
dim  :  10 52 1 1 1 1 
quant:  age 
units:  1000 

Min    :  0 
1st Qu.:  4548 
Mean   :  28141 
Median :  14030 
3rd Qu.:  40536 
Max    :  274209 
NAs    :  0 %</code></pre>
<pre class="r"><code>plot(landsn)</code></pre>
<p><img src="A_quick_introduction_to_FLR_files/figure-html/plotlandings.n-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>In a similar way, we can now convert the input <em>data.frame</em>, containing data for four data elements, as specified in the <code>slots</code> column, into an <em>FLStock</em> object, <code>ple4</code></p>
<pre class="r"><code>ple4 &lt;- as.FLStock(dat)

summary(ple4)</code></pre>
<pre><code>An object of class &quot;FLStock&quot;

Name:  
Description:  
Quant: age 
Dims:  age  year    unit    season  area    iter
    10  52  1   1   1   1   

Range:  min max pgroup  minyear maxyear minfbar maxfbar 
    1   10  10  1957    2008    1   10  

catch         : [ 1 52 1 1 1 1 ], units =  NA 
catch.n       : [ 10 52 1 1 1 1 ], units =  NA 
catch.wt      : [ 10 52 1 1 1 1 ], units =  NA 
discards      : [ 1 52 1 1 1 1 ], units =  NA 
discards.n    : [ 10 52 1 1 1 1 ], units =  1000 
discards.wt   : [ 10 52 1 1 1 1 ], units =  kg 
landings      : [ 1 52 1 1 1 1 ], units =  NA 
landings.n    : [ 10 52 1 1 1 1 ], units =  1000 
landings.wt   : [ 10 52 1 1 1 1 ], units =  kg 
stock         : [ 1 52 1 1 1 1 ], units =  NA 
stock.n       : [ 10 52 1 1 1 1 ], units =  NA 
stock.wt      : [ 10 52 1 1 1 1 ], units =  NA 
m             : [ 10 52 1 1 1 1 ], units =  m 
mat           : [ 10 52 1 1 1 1 ], units =   
harvest       : [ 10 52 1 1 1 1 ], units =  NA 
harvest.spwn  : [ 10 52 1 1 1 1 ], units =   
m.spwn        : [ 10 52 1 1 1 1 ], units =   </code></pre>
<p>To complete this <em>FLStock</em> object we will need to specify the natural mortality, <em>m</em>, in this case as a constant value of 0.1 for all ages and years,</p>
<pre class="r"><code>m(ple4) &lt;- 0.1</code></pre>
<p>the proportion of natural and fishing mortality that takes place before spawning, assumed to be zero in both cases,</p>
<pre class="r"><code>m.spwn(ple4) &lt;- harvest.spwn(ple4) &lt;- 0</code></pre>
<p>and the maturity at age, as the proportion mature, as a vector repeated for all years.</p>
<pre class="r"><code>mat(ple4) &lt;- c(0, 0.5, 0.5, rep(1, 7))</code></pre>
<p>We now must compute the overall landings and discards, in biomass, from the age-disaggregated values,</p>
<pre class="r"><code>landings(ple4) &lt;- computeLandings(ple4)
discards(ple4) &lt;- computeDiscards(ple4)</code></pre>
<p>and then the catch slots from both landings and discards</p>
<pre class="r"><code>catch(ple4) &lt;- computeCatch(ple4, slot=&quot;all&quot;)</code></pre>
<p>The mean weigth-at-age in the stock needs to be provided. In this case we will assume it is the same as the one computed from the catch sampling programme</p>
<pre class="r"><code>stock.wt(ple4) &lt;- catch.wt(ple4)</code></pre>
<p>We finalize by specifying the fully selected age range, used in the calculation of an overall index of fishing mortality, for example as the mean, using <code>fbar()</code>, or as the maximum value, using <code>fapex()</code> across those ages. This information is part of the object’s <em>range</em>.</p>
<pre class="r"><code>range(ple4, c(&quot;minfbar&quot;, &quot;maxfbar&quot;)) &lt;- c(2, 6)</code></pre>
<p>If we now inspect the resulting object we can see that all calculated slots have been assigned the corresponding <em>units</em> of measurement, except for those that will hold the estimates coming from a stock assessment model: <em>stock</em>, <em>stock.n</em> and <em>stock.wt</em> for the estimates of abundance, and <em>harvest</em> for the estimates of fishing mortality at age.</p>
<pre class="r"><code>summary(ple4)</code></pre>
<pre><code>An object of class &quot;FLStock&quot;

Name:  
Description:  
Quant: age 
Dims:  age  year    unit    season  area    iter
    10  52  1   1   1   1   

Range:  min max pgroup  minyear maxyear minfbar maxfbar 
    1   10  10  1957    2008    2   6   

catch         : [ 1 52 1 1 1 1 ], units =  t 
catch.n       : [ 10 52 1 1 1 1 ], units =  1000 
catch.wt      : [ 10 52 1 1 1 1 ], units =  kg 
discards      : [ 1 52 1 1 1 1 ], units =  t 
discards.n    : [ 10 52 1 1 1 1 ], units =  1000 
discards.wt   : [ 10 52 1 1 1 1 ], units =  kg 
landings      : [ 1 52 1 1 1 1 ], units =  t 
landings.n    : [ 10 52 1 1 1 1 ], units =  1000 
landings.wt   : [ 10 52 1 1 1 1 ], units =  kg 
stock         : [ 1 52 1 1 1 1 ], units =  NA 
stock.n       : [ 10 52 1 1 1 1 ], units =  NA 
stock.wt      : [ 10 52 1 1 1 1 ], units =  kg 
m             : [ 10 52 1 1 1 1 ], units =  m 
mat           : [ 10 52 1 1 1 1 ], units =   
harvest       : [ 10 52 1 1 1 1 ], units =  NA 
harvest.spwn  : [ 10 52 1 1 1 1 ], units =   
m.spwn        : [ 10 52 1 1 1 1 ], units =   </code></pre>
<pre class="r"><code>plot(metrics(ple4, Catch=catch, Landings=landings))</code></pre>
<p><img src="A_quick_introduction_to_FLR_files/figure-html/ple4-1.png" width="672" style="display: block; margin: auto;" /></p>
<div id="more-information-1" class="section level3">
<h3>More information</h3>
<p>Please see the <a href="Reading_data_into_FLR.html">Reading data into FLR</a> tutorial for more examples on how to get your data into into <strong>FLR</strong>.</p>
</div>
</div>
<div id="visualizing-and-plotting" class="section level1">
<h1>Visualizing and plotting</h1>
</div>
<div id="running-a-stock-assessment" class="section level1">
<h1>Running a stock assessment</h1>
<p>An important step in providing management advice for a fish stock is the estimation of current status, past history and stock productivity through an stock assessment (SA) model. The <em>FLStock</em> object we have created contains some of the inputs required for most SA models: catches, natural mortality, and maturity. What is now needed is some indication of changes in abundance over the period of exploitation, an index of abundance, derived from either research surveys or catch-per-unit-effort of commercial fleets.</p>
<div id="index-of-abundance" class="section level2">
<h2>Index of abundance</h2>
<p>An index of abundance for the North Sea plaice stock, as an object of class <a href="http://www.flr-project.org/FLCore/reference/FLIndex.html">FLIndex</a>, is available as an example dataset in <em>FLCore</em>, and can be loaded using the <em>data</em> command</p>
<pre class="r"><code>data(ple4.index)</code></pre>
<p>This time series of abundances at age, covering from 1985 to 2008, was obtained during the <a href="http://ocean.ices.dk/Project/IBTS/">ICES International Bottom Trawl Survey</a>, as is one of the indices used by the Working Group on the Assessment of Demersal Stocks in the North Sea and Skagerrak (WGNSSK).</p>
<p>The <em>FLIndex</em> class is able to contain not only the index of abundance, in this case as an age-structured <em>FLQuant</em>, but also other information on variance, associated catches, effort, selectivity and catchability, which might be used by certain methods.</p>
<pre class="r"><code>summary(ple4.index)</code></pre>
<pre><code>An object of class &quot;FLIndex&quot;

Name: BTS-Isis 
Description: Plaice in IV . Imported from VPA file. 
Type :   
Distribution :   
Quant: age 
Dims:  age  year    unit    season  area    iter
    8   24  1   1   1   1   

Range:  min max pgroup  minyear maxyear startf  endf 
    1   8   NA  1985    2008    0.66    0.75    

index         : [ 8 24 1 1 1 1 ], units =  NA 
index.var     : [ 8 24 1 1 1 1 ], units =  NA 
catch.n       : [ 8 24 1 1 1 1 ], units =  NA 
catch.wt      : [ 8 24 1 1 1 1 ], units =  NA 
effort        : [ 1 24 1 1 1 1 ], units =  NA 
sel.pattern   : [ 8 24 1 1 1 1 ], units =  NA 
index.q       : [ 8 24 1 1 1 1 ], units =  NA </code></pre>
<pre class="r"><code>plot(ple4.index)</code></pre>
<p><img src="A_quick_introduction_to_FLR_files/figure-html/summaryple4index-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>The <em>range</em> slot in this class contains information about the time period over which the survey takes place, as proportions of the year, in this case from the beginning of August to the end of September.</p>
<pre class="r"><code>range(ple4.index)[c(&quot;startf&quot;, &quot;endf&quot;)]</code></pre>
<pre><code>startf   endf 
  0.66   0.75 </code></pre>
</div>
<div id="a4a-statistical-catch-at-age" class="section level2">
<h2>a4a statistical catch-at-age</h2>
<p>The <a href="http:flr-project.org/FLa4a">FLa4a</a> package provides an <strong>FLR</strong> implementation of the <em>a4a</em> model, an statistical catch-at-age model of medium complexity that has been designed to make use of the power and flexibility of R’s formula-based model notation (as used for example in <a href="https://stat.ethz.ch/R-manual/R-patched/library/stats/html/lm.html">lm</a>), while giving access to a solid and fast minimization algorithm implemented using <a href="http://www.admb-project.org/">AD Model Builder</a>.</p>
<pre class="r"><code>library(FLa4a)</code></pre>
<p>A first go at fitting this model to the <em>ple4</em> and <em>ple4.index</em> datasets requires a single line of code</p>
<pre class="r"><code>fit &lt;- sca(ple4, FLIndices(BTS=ple4.index))</code></pre>
<p>This returns an object of class a4aFit that contains the results fo the model fit, including the estimated catch-at-age, and the derived abundances and fishing mortality at age</p>
<pre class="r"><code>summary(fit)</code></pre>
<pre><code>An object of class &quot;a4aFit&quot;

Name:  
Description:  
Quant: age 
Dims:  age  year    unit    season  area    iter
    10  52  1   1   1   1   

Range:  min max pgroup  minyear maxyear minfbar maxfbar 
    1   10  10  1957    2008    2   6   

stock.n       : [ 10 52 1 1 1 1 ], units =  NA 
harvest       : [ 10 52 1 1 1 1 ], units =  f 
catch.n       : [ 10 52 1 1 1 1 ], units =  NA </code></pre>
<p>which we can use to update the <em>FLStock</em> object</p>
<pre class="r"><code>stk &lt;- ple4 + fit
plot(stk)</code></pre>
<p><img src="A_quick_introduction_to_FLR_files/figure-html/ple4fit-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Among other methods, <em>FLa4a</em> provides a range of tools for inspecting the quality of the model fit. For example, a set of residuals, for the fits to both the index olf abundance and</p>
<div id="more-information-2" class="section level3">
<h3>More information</h3>
<p>Please see the <a href=".html"></a> tutorial for more examples on how to .</p>
</div>
</div>
</div>
<div id="exploring-the-stock-recruitment-relationship" class="section level1">
<h1>Exploring the stock-recruitment relationship</h1>
<p>Fitting a model for the relationship between stock abundance and expected recruitment is necessary for forecasting the future dynamics of the stock under various levels of fishing mortality, the central element of fisheries management advice. Certain stock assessment models, for example most statistical catch-at-age models, include the stock-recruitment model in the estimated parameters, but for others, like Virtual Population Analysis, this is a setup carried out once the stock of population abundace have been obtained.</p>
<p>Both inputs and outputs for stock-recruitment models are stored in an object of the <a href="http://www.flr-project.org/FLCore/reference/FLSR.html">FLSR</a> class which we can create directly from the SA results by coertion using</p>
<pre class="r"><code>plsr &lt;- as.FLSR(stk)</code></pre>
<p>The resulting <em>FLSR</em> object contains the series of recruitment <code>rec</code>, the abundance of the first age, and the stock reproductive potential, in this case the spawning stock biomass <code>ssb</code>. Both series are already displaced as corresponds by the age of recruitment, 1 in this case.</p>
<pre class="r"><code>summary(plsr)</code></pre>
<pre><code>An object of class &quot;FLSR&quot;

Name:  
Description: &#39;rec&#39; and &#39;ssb&#39; slots obtained from a &#39;FLStock&#39; object 
Quant: age 
Dims:  age  year    unit    season  area    iter
    1   51  1   1   1   1   

Range:  min minyear max maxyear 
    1   1958    1   2008    

rec           : [ 1 51 1 1 1 1 ], units =  NA 
ssb           : [ 1 51 1 1 1 1 ], units =  kg 
residuals     : [ 1 51 1 1 1 1 ], units =  NA 
fitted        : [ 1 51 1 1 1 1 ], units =  NA 

Model:  list()
&lt;environment: 0x14e2e390&gt;
Parameters: 
    params
iter
   1

Log-likelihood:  NA(NA) 
Variance-covariance: &lt;0 x 0 matrix&gt;</code></pre>
<p>We now need to choose a model to fit, and <em>FLCore</em> provides a number of them already defined in terms of:</p>
<ul>
<li>the model formula, kept in the <code>model</code> slot</li>
<li>a function returning the log-likelihood, to be used for minimization, in the <code>logl</code> slot</li>
<li>a function to obtain initial values for the minimization procedure, in the <code>initial</code> slot</li>
</ul>
<p>See the <a href="http://www.flr-project.org/FLCore/reference/FLSR.html">SR Models</a> help page for further details of the available models.</p>
<p>We can now assign the output of the chosen model function, in this case <code>ricker()</code> to the existing object using</p>
<pre class="r"><code>model(plsr) &lt;- ricker()</code></pre>
<p>The model object is ready to fit, through Maximum Likelihood Estimation (MLE), using the <code>fmle</code> method defined in <em>FLCore</em>. This makes use of R’s <code>optim</code>, but defaults to the Melder-Mead algorithm.</p>
<pre class="r"><code>plsr &lt;- fmle(plsr)</code></pre>
<p>Another look at the object ill show us that a number of slots now contain the results of the model fit, among them:</p>
<ul>
<li><code>fitted</code> for the estimated recruitment, as an <em>FLQuant</em></li>
<li><code>residuals</code> for the residuals in log space, <em>FLQuant</em></li>
<li><code>params</code> for the estimated parameters, as an object of class <em>FLPar</em></li>
<li><code>vcov</code> for the variance-covariance matrix, as an <em>array</em></li>
</ul>
<p>The standard plot for the class shows the model fit and a series of useful diagnostics that will help us evaluating the its quality and usefulness for future projections. This can be further explored by likelihood profiling over a range of values of the estimated parameters, simply calling the <code>profile</code> method of the object</p>
<pre class="r"><code>profile(plsr)</code></pre>
<p><img src="A_quick_introduction_to_FLR_files/figure-html/flsrprofile-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Finally, the model can be used to predict future recruitments if provided with a set of new of values of SSB, as in</p>
<pre class="r"><code>predict(plsr, ssb=FLQuant(rnorm(10, 25e4, sd(ssb(plsr))), dimnames=list(age=1, year=2008:2017)))</code></pre>
<pre><code>An object of class &quot;FLQuant&quot;
An object of class &quot;FLQuant&quot;
, , unit = unique, season = all, area = unique

   year
age 2008   2009   2010   2011   2012   2013   2014   2015   2016   2017  
  1 941825 946690 948331 830527 948135 941482 863156 926300 929223 886520

units:  NA </code></pre>
<div id="more-information-3" class="section level3">
<h3>More information</h3>
<p>Please see the <a href="Modelling_stock_recruitment_with_FLSR.html">Modelling stock recruitment with FLSR</a> tutorial for more examples and information on the stock-recruitment model fitting capabilities of <strong>FLR</strong>.</p>
</div>
</div>
<div id="estimating-reference-points" class="section level1">
<h1>Estimating reference points</h1>
<div id="more-information-4" class="section level3">
<h3>More information</h3>
<p>Please see the <a href=".html"></a> tutorial for more examples on how to .</p>
</div>
</div>
<div id="forecasting-under-different-scenarios" class="section level1">
<h1>Forecasting under different scenarios</h1>
<div id="more-information-5" class="section level3">
<h3>More information</h3>
<p>Please see the <a href=".html"></a> tutorial for more examples on how to .</p>
</div>
</div>
<div id="management-strategy-evaluation" class="section level1">
<h1>Management Strategy Evaluation</h1>
</div>
<div id="references" class="section level1">
<h1>References</h1>
<p>L. T. Kell, I. Mosqueira, P. Grosjean, J-M. Fromentin, D. Garcia, R. Hillary, E. Jardim, S. Mardle, M. A. Pastoors, J. J. Poos, F. Scott, R. D. Scott; FLR: an open-source framework for the evaluation and development of management strategies. <em>ICES J Mar Sci</em> 2007; 64 (4): 640-646. doi: <a href="https://doi.org/10.1093/icesjms/fsm012">10.1093/icesjms/fsm012</a>.</p>
</div>
<div id="more-information-6" class="section level1">
<h1>More information</h1>
<ul>
<li>You can submit bug reports, questions or suggestions on this tutorial at <a href="https://github.com/flr/doc/issues" class="uri">https://github.com/flr/doc/issues</a>.</li>
<li>Alternatively, send a pull request to <a href="https://github.com/flr/doc/" class="uri">https://github.com/flr/doc/</a>.</li>
<li>For more information on the FLR Project for Quantitative Fisheries Science in R, visit the FLR webpage: <a href="http://flr-project.org" class="uri">http://flr-project.org</a>.</li>
</ul>
<div id="software-versions" class="section level2">
<h2>Software Versions</h2>
<ul>
<li>R version 3.4.1 (2017-06-30)</li>
<li>FLCore: 2.6.3.9009</li>
<li><strong>Compiled</strong>: Sat Aug 26 15:53:34 2017</li>
</ul>
</div>
<div id="license" class="section level2">
<h2>License</h2>
<p>This document is licensed under the <a href="https://creativecommons.org/licenses/by-sa/4.0">Creative Commons Attribution-ShareAlike 4.0 International</a> license.</p>
</div>
<div id="author-information" class="section level2">
<h2>Author information</h2>
<p><strong>Iago MOSQUEIRA</strong>. European Commission, DG Joint Research Centre, Directorate D - Sustainable Resources, Unit D.02 Water and Marine Resources, Via E. Fermi 2749, 21027 Ispra VA, Italy. <a href="https://ec.europa.eu/jrc/" class="uri">https://ec.europa.eu/jrc/</a>.</p>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
