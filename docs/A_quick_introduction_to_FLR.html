<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>A quick introduction to FLR</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-1.1/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-1.1/highlight.js"></script>
<link href="site_libs/font-awesome-4.5.0/css/font-awesome.min.css" rel="stylesheet" />

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}

.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->






<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html"></a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="http://flr-project.org">
    <span class="fa fa-home"></span>
     
    FLR
  </a>
</li>
<li>
  <a href="index.html">
    <span class="fa fa-info"></span>
     
    Home
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-gear"></span>
     
    Introduction
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="A_quick_introduction_to_FLR.html">A quick intro</a>
    </li>
    <li>
      <a href="B.html">Page B</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-gear"></span>
     
    Input
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="A.html">Page A</a>
    </li>
    <li>
      <a href="B.html">Page B</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-gear"></span>
     
    Visualization
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="A.html">Page A</a>
    </li>
    <li>
      <a href="B.html">Page B</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-gear"></span>
     
    Modelling
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="A.html">Page A</a>
    </li>
    <li>
      <a href="B.html">Page B</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-gear"></span>
     
    Advice
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="A.html">Page A</a>
    </li>
    <li>
      <a href="B.html">Page B</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-gear"></span>
     
    MSE
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="A.html">Page A</a>
    </li>
    <li>
      <a href="B.html">Page B</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://example.com">
    <span class="fa fa-question fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">A quick introduction to FLR</h1>
<h4 class="date"><em>18 August, 2017</em></h4>

</div>


<p>The Fisheries Library in R (FLR) is a collection of tools for quantitative fisheries science, developed in the R language, that facilitates the construction of bio-economic simulation models of fisheries systems as well as the application of a wide range of quantitative analysis.</p>
<p>FLR builds on the powerful R environment and syntax to create a <a href="https://en.wikipedia.org/wiki/Domain-specific_language">domain-specific language</a> for the quantitative analysis of the expected risks and impacts of fisheries management decisions. The classes and methods in FLR consider uncertainty an integral part of our knowledge of fisheries system. […]</p>
<div id="required-packages" class="section level2">
<h2>Required packages</h2>
<p>To follow this tutorial you should have installed the following packages:</p>
<ul>
<li>FLR: <a href="http://www.flr-project.org/FLCore/">FLCore</a>, <a href="http://www.flr-project.org/FLa4a/">FLa4a</a>, <a href="http://www.flr-project.org/ggplotFL/">ggplotFL</a></li>
</ul>
<p>You can do so as follows:</p>
<pre class="r"><code>install.packages(c(&quot;FLCore&quot;), repos=&quot;http://flr-project.org/R&quot;)</code></pre>
<p>The <em>FLCore</em> package defines a 6D array as the basic data structure for <strong>FLR</strong>. This class, called <em>FLQuant</em>, is used to store most numeric inputs and output.</p>
<pre class="r"><code>library(FLCore)
library(ggplotFL)</code></pre>
</div>
<div id="loading-your-data" class="section level1">
<h1>Loading your data</h1>
<p>The first step in an analysis is to get the relevant data into the system. We will need to construct objects of certain <strong>FLR</strong> classes, but first data is loaded into the R session using any of the tools available in the language: <code>read.csv</code> for CSV files, <code>readVPA</code> and others for fisheries legacy file formats, …</p>
<p>In this example we will create an object of class <em>FLStock</em>, a representation of both inputs and outputs involved in fitting a stock assessment model, from a CSV file containing a table with five columns:</p>
<ul>
<li><em>slot</em>, the name of the input quantity, in this case either landings at age, <em>landings.n</em>, weight-at-age in the landings, <em>landings.wt</em>, and the same quantitieds for discards, <em>discards.n</em> and <em>discards.wt</em>.</li>
<li><em>age</em> and <em>year</em></li>
<li><em>data</em>, the numeric values themselves.</li>
<li><em>units</em>, a character string for the units of measurement employed: <em>kg</em> and <em>1000</em> in this case for kilograms and thousands.</li>
</ul>
<p>The file is downloaded into a temporary folder, and uncompressed. Simply change the value of <code>dir</code> to save the file in another folder.</p>
<pre class="r"><code>dir &lt;- tempdir()
download.file(&quot;http://www.flr-project.org/doc/src/ple4.csv.zip&quot;, file.path(dir, &quot;ple4.csv.zip&quot;))
unzip(file.path(dir, &quot;ple4.csv.zip&quot;), exdir=dir)</code></pre>
<p>The CSV file can now be loaded as a <code>data.frame</code> using <code>read.csv</code> and inspected</p>
<pre class="r"><code>dat &lt;- read.csv(file.path(dir, &quot;ple4.csv&quot;))
head(dat)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">slot</th>
<th align="right">age</th>
<th align="right">year</th>
<th align="right">data</th>
<th align="left">units</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">discards.n</td>
<td align="right">1</td>
<td align="right">1957</td>
<td align="right">32356</td>
<td align="left">1000</td>
</tr>
<tr class="even">
<td align="left">discards.n</td>
<td align="right">2</td>
<td align="right">1957</td>
<td align="right">45596</td>
<td align="left">1000</td>
</tr>
<tr class="odd">
<td align="left">discards.n</td>
<td align="right">3</td>
<td align="right">1957</td>
<td align="right">9220</td>
<td align="left">1000</td>
</tr>
<tr class="even">
<td align="left">discards.n</td>
<td align="right">4</td>
<td align="right">1957</td>
<td align="right">909</td>
<td align="left">1000</td>
</tr>
<tr class="odd">
<td align="left">discards.n</td>
<td align="right">5</td>
<td align="right">1957</td>
<td align="right">961</td>
<td align="left">1000</td>
</tr>
<tr class="even">
<td align="left">discards.n</td>
<td align="right">6</td>
<td align="right">1957</td>
<td align="right">25</td>
<td align="left">1000</td>
</tr>
</tbody>
</table>
<p>The <code>df</code> data.frame contains the time series of landings and discards at age, in thousands, and the corresponding mean weights-at-age, in kg, for <a href="http://standardgraphs.ices.dk/ViewCharts.aspx?key=8980">North Sea plaice</a> (<em>Pleuronectes platessa</em>, ICES ple.27.420).</p>
<p>We can create an object to store the landings-at-age data by subsetting it from the <em>data.frame</em></p>
<pre class="r"><code>landn &lt;- subset(dat, slot==&quot;landings.n&quot;, select=-slot)</code></pre>
<p>and then convert into an <em>FLQuant</em> using</p>
<pre class="r"><code>landsn &lt;- as.FLQuant(landn)</code></pre>
<p>The object can now be inspected and plotted using the FLR-defined methods</p>
<pre class="r"><code>summary(landsn)</code></pre>
<pre><code>An object of class &quot;FLQuant&quot; with:
dim  :  10 52 1 1 1 1 
quant:  age 
units:  1000 

Min    :  0 
1st Qu.:  4548 
Mean   :  28141 
Median :  14030 
3rd Qu.:  40536 
Max    :  274209 
NAs    :  0 %</code></pre>
<pre class="r"><code>plot(landsn)</code></pre>
<p><img src="A_quick_introduction_to_FLR_files/figure-html/plotlandings.n-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>In a similar way, we can now convert the input <em>data.frame</em>, containing data for four data elements, as specified in the <code>slots</code> column, into an <em>FLStock</em> object, <code>ple4</code></p>
<pre class="r"><code>ple4 &lt;- as.FLStock(dat)

summary(ple4)</code></pre>
<pre><code>An object of class &quot;FLStock&quot;

Name:  
Description:  
Quant: age 
Dims:  age  year    unit    season  area    iter
    10  52  1   1   1   1   

Range:  min max pgroup  minyear maxyear minfbar maxfbar 
    1   10  10  1957    2008    1   10  

catch         : [ 1 52 1 1 1 1 ], units =  NA 
catch.n       : [ 10 52 1 1 1 1 ], units =  NA 
catch.wt      : [ 10 52 1 1 1 1 ], units =  NA 
discards      : [ 1 52 1 1 1 1 ], units =  NA 
discards.n    : [ 10 52 1 1 1 1 ], units =  1000 
discards.wt   : [ 10 52 1 1 1 1 ], units =  kg 
landings      : [ 1 52 1 1 1 1 ], units =  NA 
landings.n    : [ 10 52 1 1 1 1 ], units =  1000 
landings.wt   : [ 10 52 1 1 1 1 ], units =  kg 
stock         : [ 1 52 1 1 1 1 ], units =  NA 
stock.n       : [ 10 52 1 1 1 1 ], units =  NA 
stock.wt      : [ 10 52 1 1 1 1 ], units =  NA 
m             : [ 10 52 1 1 1 1 ], units =  m 
mat           : [ 10 52 1 1 1 1 ], units =   
harvest       : [ 10 52 1 1 1 1 ], units =  NA 
harvest.spwn  : [ 10 52 1 1 1 1 ], units =   
m.spwn        : [ 10 52 1 1 1 1 ], units =   </code></pre>
<p>To complete this <em>FLStock</em> object we will need to specify the natural mortality, <em>m</em>, in this case as a constant value of 0.1 for all ages and years,</p>
<pre class="r"><code>m(ple4) &lt;- 0.1</code></pre>
<p>the proportion of natural and fishing mortality that takes place before spawning, assumed to be zero in both cases,</p>
<pre class="r"><code>m.spwn(ple4) &lt;- harvest.spwn(ple4) &lt;- 0</code></pre>
<p>and the maturity at age, as the proportion mature, as a vector repeated for all years.</p>
<pre class="r"><code>mat(ple4) &lt;- c(0, 0.5, 0.5, rep(1, 7))</code></pre>
<p>We now must compute the overall landings and discards, in biomass, from the age-disaggregated values,</p>
<pre class="r"><code>landings(ple4) &lt;- computeLandings(ple4)
discards(ple4) &lt;- computeDiscards(ple4)</code></pre>
<p>and then the catch slots from both landings and discards</p>
<pre class="r"><code>catch(ple4) &lt;- computeCatch(ple4, slot=&quot;all&quot;)</code></pre>
<p>We finalize by specifying the fully selected age range, used in the calculation of an overall index of fishing mortality, for example as the mean, using <code>fbar()</code>, or as the maximum value, using <code>fapex()</code> across those ages. This information is part of the object’s <em>range</em>.</p>
<pre class="r"><code>range(ple4, c(&quot;minfbar&quot;, &quot;maxfbar&quot;)) &lt;- c(2, 6)</code></pre>
<p>If we now inspect the resulting object we can see that all calculated slots have been assigned the corresponding <em>units</em> of measurement, except for those that will hold the estimates coming from a stock assessment model: <em>stock</em>, <em>stock.n</em> and <em>stock.wt</em> for the estimates of abundance, and <em>harvest</em> for the estimates of fishing mortality at age.</p>
<pre class="r"><code>summary(ple4)</code></pre>
<pre><code>An object of class &quot;FLStock&quot;

Name:  
Description:  
Quant: age 
Dims:  age  year    unit    season  area    iter
    10  52  1   1   1   1   

Range:  min max pgroup  minyear maxyear minfbar maxfbar 
    1   10  10  1957    2008    2   6   

catch         : [ 1 52 1 1 1 1 ], units =  t 
catch.n       : [ 10 52 1 1 1 1 ], units =  1000 
catch.wt      : [ 10 52 1 1 1 1 ], units =  kg 
discards      : [ 1 52 1 1 1 1 ], units =  t 
discards.n    : [ 10 52 1 1 1 1 ], units =  1000 
discards.wt   : [ 10 52 1 1 1 1 ], units =  kg 
landings      : [ 1 52 1 1 1 1 ], units =  t 
landings.n    : [ 10 52 1 1 1 1 ], units =  1000 
landings.wt   : [ 10 52 1 1 1 1 ], units =  kg 
stock         : [ 1 52 1 1 1 1 ], units =  NA 
stock.n       : [ 10 52 1 1 1 1 ], units =  NA 
stock.wt      : [ 10 52 1 1 1 1 ], units =  NA 
m             : [ 10 52 1 1 1 1 ], units =  m 
mat           : [ 10 52 1 1 1 1 ], units =   
harvest       : [ 10 52 1 1 1 1 ], units =  NA 
harvest.spwn  : [ 10 52 1 1 1 1 ], units =   
m.spwn        : [ 10 52 1 1 1 1 ], units =   </code></pre>
<pre class="r"><code>plot(metrics(ple4, Catch=catch, Landings=landings))</code></pre>
<p><img src="A_quick_introduction_to_FLR_files/figure-html/ple4-1.png" width="672" style="display: block; margin: auto;" /></p>
<div id="more-information" class="section level2">
<h2>More information</h2>
<p>Please see the <a href="Reading_data_into_FLR.html">Reading data into FLR</a> tutorial for more examples on how to get your into into <strong>FLR</strong>.</p>
</div>
</div>
<div id="visualizing-and-plotting" class="section level1">
<h1>Visualizing and plotting</h1>
</div>
<div id="running-a-stock-assessment" class="section level1">
<h1>Running a stock assessment</h1>
</div>
<div id="exploring-the-stock-recruitment-relationship" class="section level1">
<h1>Exploring the stock-recruitment relationship</h1>
</div>
<div id="estimating-reference-points" class="section level1">
<h1>Estimating reference points</h1>
</div>
<div id="forecasting-undr-different-scenarios" class="section level1">
<h1>Forecasting undr different scenarios</h1>
</div>
<div id="references" class="section level1">
<h1>References</h1>
<p>L. T. Kell, I. Mosqueira, P. Grosjean, J-M. Fromentin, D. Garcia, R. Hillary, E. Jardim, S. Mardle, M. A. Pastoors, J. J. Poos, F. Scott, R. D. Scott; FLR: an open-source framework for the evaluation and development of management strategies. <em>ICES J Mar Sci</em> 2007; 64 (4): 640-646. doi: <a href="https://doi.org/10.1093/icesjms/fsm012">10.1093/icesjms/fsm012</a>.</p>
</div>
<div id="more-information-1" class="section level1">
<h1>More information</h1>
<ul>
<li>You can submit bug reports, questions or suggestions on this tutorial at <a href="https://github.com/flr/doc/issues" class="uri">https://github.com/flr/doc/issues</a>.</li>
<li>Alternatively, send a pull request to <a href="https://github.com/flr/doc/" class="uri">https://github.com/flr/doc/</a>.</li>
<li>For more information on the FLR Project for Quantitative Fisheries Science in R, visit the FLR webpage: <a href="http://flr-project.org" class="uri">http://flr-project.org</a>.</li>
</ul>
<div id="software-versions" class="section level2">
<h2>Software Versions</h2>
<ul>
<li>R version 3.4.1 (2017-06-30)</li>
<li>FLCore: 2.6.3.9008</li>
<li><strong>Compiled</strong>: Fri Aug 18 15:42:07 2017</li>
</ul>
</div>
<div id="license" class="section level2">
<h2>License</h2>
<p>This document is licensed under the <a href="https://creativecommons.org/licenses/by-sa/4.0">Creative Commons Attribution-ShareAlike 4.0 International</a> license.</p>
</div>
<div id="author-information" class="section level2">
<h2>Author information</h2>
<p><strong>Iago MOSQUEIRA</strong>. European Commission, DG Joint Research Centre, Directorate D - Sustainable Resources, Unit D.02 Water and Marine Resources, Via E. Fermi 2749, 21027 Ispra VA, Italy. <a href="https://ec.europa.eu/jrc/" class="uri">https://ec.europa.eu/jrc/</a>.</p>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
