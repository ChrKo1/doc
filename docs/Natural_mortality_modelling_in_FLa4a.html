<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Natural Mortality Modelling</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-1.1/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-1.1/highlight.js"></script>
<link href="site_libs/font-awesome-4.5.0/css/font-awesome.min.css" rel="stylesheet" />

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}

.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->






<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html"></a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="http://flr-project.org">
    <span class="fa fa-home"></span>
     
    FLR
  </a>
</li>
<li>
  <a href="index.html">
    <span class="fa fa-info"></span>
     
    Home
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-play-circle-o"></span>
     
    Intro
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="A_quick_introduction_to_FLR.html">A quick introduction to FLR</a>
    </li>
    <li>
      <a href="An_overview_of_the_FLCore_classes.html">An overview of the FLCore classes</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-database"></span>
     
    Input
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="Loading_your_data_into_FLR.html">Loading your data into FLR</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-magic"></span>
     
    Modelling
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="Modelling_stock_recruitment_with_FLSR.html">Modelling stock recruitment with FLSR</a>
    </li>
    <li>
      <a href="Statistical_catch_at_age_models_in_FLa4a.html">Statistical catch at age models in FLa4a</a>
    </li>
    <li>
      <a href="Modelling_growth_and_its_uncertainty_in_FLa4a.html">Modelling growth and its uncertainty in FLa4a</a>
    </li>
    <li>
      <a href="Natural_mortality_modelling_in_FLa4a.html">Natural mortality modelling in FLa4a</a>
    </li>
    <li>
      <a href="Stock_assessment_using_eXtended_Survivors_Analysis_with_FLXSA.html">Stock assessment using eXtended Survivors Analysis with FLXSA</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-tachometer"></span>
     
    Advice
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="Running_Medium_Term_Forecasts_with_FLash.html">Running Medium Term Forecasts with FLash</a>
    </li>
    <li>
      <a href="Short_Term_Forecasting_for_advice_using_FLash.html">Short Term Forecasting for advice using FLash</a>
    </li>
    <li>
      <a href="Forecasting_on_the_Medium_Term_for_advice_using_FLasher.html">Forecasting on the Medium Term for advice using FLasher</a>
    </li>
    <li>
      <a href="Reference_points_for_fisheries_management_with_FLBRP.html">Reference points for fisheries management with FLBRP</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-cogs"></span>
     
    MSE
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">An introduction to MSE using FLR</li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-area-chart"></span>
     
    Plotting
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="ggplotFL_plotting_FLR_objects_with_ggplot2.html">ggplotFL, plotting FLR objects with ggplot2</a>
    </li>
    <li>
      <a href="Plotting_FLR_objects_using_lattice.html">Plotting FLR objects using lattice</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-puzzle-piece"></span>
     
    Internals
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="Units_of_measurement_in_FLR_objects.html">Units of measurement in FLR objects</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="http://github.com/flr/doc/issues">
    <span class="fa fa-question fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Natural Mortality Modelling</h1>
<h3 class="subtitle"><em>Assessment for All initiative (a4a)</em></h3>
<h4 class="date"><em>18 September, 2017</em></h4>

</div>


<p>The document explains the approach being developed by a4a to integrate uncertainty in natural mortality into stock assessment and advice. It presents a mixture of text and code, where the former explains the concepts behind the methods, while the latter shows how these can be run with the software provided.</p>
<div id="required-packages" class="section level2">
<h2>Required packages</h2>
<p>To follow this tutorial you should have installed the following packages:</p>
<ul>
<li><p>CRAN: <a href="https://cran.r-project.org/web/packages/copula/index.html">copula</a>, <a href="https://cran.r-project.org/web/packages/triangle/index.html">triangle</a>, <a href="https://cran.r-project.org/web/packages/coda/index.html">coda</a>, <a href="https://cran.r-project.org/web/packages/XML/index.html">XML</a>,<a href="https://cran.r-project.org/web/packages/reshape2/index.html">reshape2</a>, <a href="https://cran.r-project.org/web/packages/latticeExtra/index.html">latticeExtra</a></p></li>
<li><p>FLR: <a href="http://www.flr-project.org/FLCore/">FLCore</a>, <a href="http://www.flr-project.org/FLa4a/">FLa4a</a></p></li>
</ul>
<p>You can do so as follows,</p>
<pre class="r"><code>install.packages(c(&quot;copula&quot;,&quot;triangle&quot;, &quot;coda&quot;, &quot;XML&quot;, &quot;reshape2&quot;, &quot;latticeExtra&quot;))
# from FLR
install.packages(c(&quot;FLCore&quot;, &quot;FLa4a&quot;), repos=&quot;http://flr-project.org/R&quot;)</code></pre>
<pre class="r"><code># Load all necessary packages and datasets, trim pkg messages
library(FLa4a)
library(XML)
library(reshape2)
library(latticeExtra)
data(ple4)
data(ple4.indices)
data(ple4.index)
data(rfLen)</code></pre>
</div>
<div id="background" class="section level1">
<h1>Background</h1>
<p>In a4a, natural mortality is dealt with as an external parameter to the stock assessment model. The rationale for modelling natural mortality is similar to that for growth: one should be able to obtain information from a range of sources and feed it into the assessment.</p>
<p>The mechanism used by a4a is to build an interface that is transparent and flexible, and makes it easy to explore different options. In relation to natural mortality, it means that the analyst should be able to use distinct models like Gislasson’s, Charnov’s, Pauly’s, etc., in a coherent framework, making it possible to compare the outcomes of the assessment.</p>
<p>Within the a4a framework, the general method for inserting natural mortality in the stock assessment is to:</p>
<ul>
<li>Create an object of class <code>a4aM</code> which holds the natural mortality model and parameters.</li>
<li>Add uncertainty to the parameters in the <code>a4aM</code> object.</li>
<li>Apply the <code>m()</code> method to the <code>a4aM</code> object to create an age or length based <code>FLQuant</code> object of the required dimensions.</li>
</ul>
<p>The resulting <code>FLQuant</code> object can then be directly inserted into an <code>FLStock</code> object to be used for the assessment.</p>
<p>In this section we go through each of the steps in detail using a variety of different models.</p>
<p>For more information on the a4a methodologies refer to <a href="http://icesjms.oxfordjournals.org/content/early/2014/04/03/icesjms.fsu050.abstract">Jardim, et.al, 2014</a>, <a href="http://icesjms.oxfordjournals.org/content/early/2014/03/31/icesjms.fsu043.abstract">Millar, et.al, 2014</a> and <a href="http://journals.plos.org/plosone/article?id=10.1371/journal.pone.0154922">Scott, et.al, 2016</a>.</p>
</div>
<div id="a4am---the-m-class" class="section level1">
<h1><code>a4aM</code> - The M class</h1>
<p>Natural mortality is implemented in a class named <code>a4aM</code>. This class is made up of three objects of the class <code>FLModelSim</code>. Each object is a model that represents one effect: an age or length effect, a scaling (level) effect and a time trend, named <em>shape</em>, <em>level</em> and <em>trend</em>, respectively. The impact of the models is multiplicative, i.e. the overal natural mortality is given by <em>shape</em> x <em>level</em> x <em>trend</em>. Check the help files for more information.</p>
<pre class="r"><code>showClass(&quot;a4aM&quot;)</code></pre>
<pre><code>Class &quot;a4aM&quot; [package &quot;FLa4a&quot;]

Slots:
                                                                        
Name:       shape      level      trend       name       desc      range
Class: FLModelSim FLModelSim FLModelSim  character  character    numeric

Extends: &quot;FLComp&quot;</code></pre>
<p>The <code>a4aM</code> constructor requires that the models and parameters are provided. The default method will build each of these models as a constant value of 1.</p>
<p>As a simple example, the usual “0.2” guesstimate could be set up by setting the <em>level</em> model to have a single parameter with a fixed value, while the other two models, <em>shape</em> and <em>trend</em>, have a default value of 1 (meaning that they have no effect).</p>
<pre class="r"><code>mod02 &lt;- FLModelSim(model=~a, params=FLPar(a=0.2))
m1 &lt;- a4aM(level=mod02)
m1</code></pre>
<pre><code>a4aM object:
  shape: ~1
  level: ~a
  trend: ~1</code></pre>
<p>More interesting natural mortality shapes can be set up using biological knowledge. The following example uses an exponential decay over ages (implying that the resulting <code>FLQuant</code> generated by the <code>m()</code> method will be age based). We also use Jensen’s second estimator <a href="http://onlinelibrary.wiley.com/doi/10.1111/faf.12027/abstract">Kenchington, 2013</a> as a scaling <em>level</em> model, which is based on the von Bertalanffy <span class="math inline">\(k\)</span> parameter, <span class="math inline">\(M=1.5k\)</span>.</p>
<pre class="r"><code>shape2 &lt;- FLModelSim(model=~exp(-age-0.5))
level2 &lt;- FLModelSim(model=~1.5*k, params=FLPar(k=0.4))
m2 &lt;- a4aM(shape=shape2, level=level2)
m2</code></pre>
<pre><code>a4aM object:
  shape: ~exp(-age - 0.5)
  level: ~1.5 * k
  trend: ~1</code></pre>
<p>Note that the <em>shape</em> model has <em>age</em> as a parameter, but is not set using the <em>params</em> argument.</p>
<p>The <em>shape</em> model does not have to be age-based. For example, here we set up a <em>shape</em> model using Gislason’s second estimator <a href="http://onlinelibrary.wiley.com/doi/10.1111/faf.12027/abstract">Kenchington, 2013</a>: <span class="math inline">\(M_l=K(\frac{L_{\inf}}{l})^{1.5}\)</span>. We use the default <em>level</em> and <em>trend</em> models. The current <code>m()</code> method is not ideal for length-based methods because you cannot specify length ranges and half-widths to make compatible with <code>FLStockLen</code></p>
<pre class="r"><code>shape_len &lt;- FLModelSim(model=~k*(linf/len)^1.5, params=FLPar(linf=60, k=0.4))
m_len &lt;- a4aM(shape=shape_len)</code></pre>
<p>Another option is to model how an external factor may impact the natural mortality. This can be added through the <em>trend</em> model. Suppose natural mortality can be modelled with a dependency on the NAO index, due to some mechanism that results in having lower mortality when NAO is negative and higher when it’s positive. In this example, the impact is represented by the NAO value in the quarter before spawning, which occurs in the second quarter.</p>
<p>We use this to make a complicated natural mortality model with an age based <em>shape</em> model, a <em>level</em> model based on <span class="math inline">\(k\)</span> and a <em>trend</em> model driven by NAO, where mortality increases by 50% if NAO is positive in the first quarter. Note, this example needs an internet connection to access the NAO data.</p>
<pre class="r"><code># Get NAO
nao.orig &lt;- read.table(&quot;https://www.esrl.noaa.gov/psd/data/correlation/nao.data&quot;, skip=1, nrow=62, na.strings=&quot;-99.90&quot;)
dnms &lt;- list(quant=&quot;nao&quot;, year=1948:2009, unit=&quot;unique&quot;, season=1:12, area=&quot;unique&quot;)
# Build an FLQuant from the NAO data, with the season slot representing months
nao.flq &lt;- FLQuant(unlist(nao.orig[,-1]), dimnames=dnms, units=&quot;nao&quot;)
# Build covar by calculating the mean over the first 3 months
nao &lt;- seasonMeans(nao.flq[,,,1:3]) 
# Turn into Boolean
nao &lt;- (nao&gt;0)
# Constructor
trend3 &lt;- FLModelSim(model=~1+b*nao, params=FLPar(b=0.5))
shape3 &lt;- FLModelSim(model=~exp(-age-0.5))
level3 &lt;- FLModelSim(model=~1.5*k, params=FLPar(k=0.4))
m3 &lt;- a4aM(shape=shape3, level=level3, trend=trend3)
m3</code></pre>
<pre><code>a4aM object:
  shape: ~exp(-age - 0.5)
  level: ~1.5 * k
  trend: ~1 + b * nao</code></pre>
</div>
<div id="adding-uncertainty-to-natural-mortality-parameters-with-a-multivariate-normal-distribution" class="section level1">
<h1>Adding uncertainty to natural mortality parameters with a multivariate normal distribution</h1>
<p>Uncertainty in natural mortality is added through uncertainty in the parameters.</p>
<p>In this section we’ll show how to add multivariate normal uncertainty. We make use of method <code>mvrnorm()</code> from class <code>FLModelSim</code>, which is a wrapper for the method <code>mvrnorm()</code> distributed by the package <strong>MASS</strong>.</p>
<p>We’ll create an <code>a4aM</code> object with an exponential <em>shape</em>, a <em>level</em> model based on <span class="math inline">\(k\)</span> and temperature (Jensen’s third estimator), and a <em>trend</em> model driven by the NAO (as above). Afterwards, a variance-covariance matrix for the <em>level</em> and <em>trend</em> models will be included. Finally, we create an object with 100 iterations using the <code>mvrnorm()</code> method.</p>
<pre class="r"><code># Create the object using shape, level and trend models
shape4 &lt;- FLModelSim(model=~exp(-age-0.5))
level4 &lt;- FLModelSim(model=~k^0.66*t^0.57, params=FLPar(k=0.4, t=10), vcov=array(c(0.002, 0.01, 0.01, 1), dim=c(2,2)))
trend4 &lt;- FLModelSim(model=~1+b*nao, params=FLPar(b=0.5), vcov=matrix(0.02))
m4 &lt;- a4aM(shape=shape4, level=level4, trend=trend4)
# Call mvrnorm()
m4 &lt;- mvrnorm(100, m4)
m4</code></pre>
<pre><code>a4aM object:
  shape: ~exp(-age - 0.5)
  level: ~k^0.66 * t^0.57
  trend: ~1 + b * nao</code></pre>
<pre class="r"><code># Inspect the models (e.g. level)
level(m4) #can also be done with m4@level</code></pre>
<pre><code>An object of class &quot;FLModelSim&quot;
Slot &quot;model&quot;:
~k^0.66 * t^0.57
&lt;environment: 0x33ced18&gt;

Slot &quot;params&quot;:
An object of class &quot;FLPar&quot;
iters:  100 

params
              k               t 
0.39811(0.0457) 9.87074(0.8623) 
units:  NA 

Slot &quot;vcov&quot;:
      [,1] [,2]
[1,] 0.002 0.01
[2,] 0.010 1.00

Slot &quot;distr&quot;:
[1] &quot;norm&quot;</code></pre>
<pre class="r"><code># Note the variance in the parameters (e.g. trend) 
params(trend(m4))</code></pre>
<pre><code>An object of class &quot;FLPar&quot;
iters:  100 

params
             b 
0.50488(0.136) 
units:  NA </code></pre>
<pre class="r"><code># Note the shape model has no parameters and no uncertainty
params(shape(m4))</code></pre>
<pre><code>An object of class &quot;FLPar&quot;
[1] NA
units:  NA </code></pre>
<p>In this particular case, the <em>shape</em> model will not be randomized because it doesn’t have a variance-covariance matrix. Also note that because there is only one parameter in the <em>trend</em> model, the randomisation will use a univariate normal distribution.</p>
<p>The same model could be achieved by using <code>mvrnorm()</code> on each model component:</p>
<pre class="r"><code>m4 &lt;- a4aM(shape=shape4, level=mvrnorm(100, level4), trend=mvrnorm(100, trend4))</code></pre>
<p>%Note: How to include ageing error ???</p>
</div>
<div id="adding-uncertainty-to-natural-mortality-parameters-with-statistical-copulas" class="section level1">
<h1>Adding uncertainty to natural mortality parameters with statistical copulas</h1>
<p>We can also use copulas to add parameter uncertainty to the natural mortality model, similar to the way we use them for the growth model. Using a <a href="http://en.wikipedia.org/wiki/Triangle_distribution">triangle distribution</a>. We use the package <a href="http://cran.r-project.org/web/packages/triangle/index.html">triangle</a>, where this distribution is parametrized using the minimum, maximum and median values. This can be very attractive if the analyst needs to, for example, obtain information from the web or literature and perform a meta-analysis. As stated above, these processes make use of the methods implemented for the <code>FLModelSim</code> class.</p>
<p>In the following example, we’ll use Gislason’s second estimator, <span class="math inline">\(M_l=K(\frac{L_{\inf}}{l})^{1.5}\)</span>, and a triangle copula to model parameter uncertainty. The method <code>mvrtriangle()</code> is used to create 1000 iterations.</p>
<pre class="r"><code>linf &lt;- 60
k &lt;- 0.4
# vcov matrix (make up some values)
mm &lt;- matrix(NA, ncol=2, nrow=2)
# calculate variances assuming a 10% cv
diag(mm) &lt;- c((linf*0.1)^2, (k*0.1)^2)
# calculate covariances assuming a correlation of 0.2
mm[upper.tri(mm)] &lt;- mm[lower.tri(mm)] &lt;- sqrt(prod(diag(mm)))*0.2
# a good way to check is using cov2cor
cov2cor(mm)</code></pre>
<table>
<tbody>
<tr class="odd">
<td align="right">1.0</td>
<td align="right">0.2</td>
</tr>
<tr class="even">
<td align="right">0.2</td>
<td align="right">1.0</td>
</tr>
</tbody>
</table>
<pre class="r"><code># create the FLModelSim object
mgis2 &lt;- FLModelSim(model=~k*(linf/len)^1.5, params=FLPar(linf=linf, k=k), vcov=mm)
# set the lower (a), upper (b) and (optionally) centre (c) of the parameters linf and k (note, without the centre, the triangle is symmetrical)
pars &lt;- list(list(a=55,b=65), list(a=0.3, b=0.6, c=0.35))
# generate 1000 sample sets using mvrtriangle
mgis2 &lt;- mvrtriangle(1000, mgis2, paramMargins=pars)
mgis2</code></pre>
<pre><code>An object of class &quot;FLModelSim&quot;
Slot &quot;model&quot;:
~k * (linf/len)^1.5
&lt;environment: 0x33ced18&gt;

Slot &quot;params&quot;:
An object of class &quot;FLPar&quot;
iters:  1000 

params
            linf                k 
59.94387(2.1843)  0.41208(0.0749) 
units:  NA 

Slot &quot;vcov&quot;:
       [,1]   [,2]
[1,] 36.000 0.0480
[2,]  0.048 0.0016

Slot &quot;distr&quot;:
[1] &quot;un &lt;deprecated slot&gt; triangle&quot;</code></pre>
<p>The resulting parameter estimates and marginal distributions can be seen in Figure 1 and Figure 2.</p>
<div class="figure" style="text-align: center">
<img src="Natural_mortality_modelling_in_FLa4a_files/figure-html/plot_tri_gis_m-1.png" alt="Parameter estimates for Gislason's second natural mortality model based on a triangle distribution." width="672" />
<p class="caption">
Parameter estimates for Gislason’s second natural mortality model based on a triangle distribution.
</p>
</div>
<div class="figure" style="text-align: center">
<img src="Natural_mortality_modelling_in_FLa4a_files/figure-html/plot_tri_gis_m_hist-1.png" alt="Marginal distributions of the parameters for Gislason's second natural mortality model using a triangle distribution." width="672" />
<p class="caption">
Marginal distributions of the parameters for Gislason’s second natural mortality model using a triangle distribution.
</p>
</div>
<p>We now have a new model that can be used for the <em>shape</em> model. You can use the constructor or the set method to add the new model. Note that we have quite a complex method now for M. A length based <em>shape</em> model from Gislason’s work, Jensen’s third model based on temperature <em>level</em> and a time <em>trend</em> depending on an environmental index, NAO. All of the component models have uncertainty in their parameters.</p>
<pre class="r"><code>#Using the constructor
m5 &lt;- a4aM(shape=mgis2, level=level4, trend=trend4)
# or the set method for shape to change m4 previously created
m5 &lt;- m4
shape(m5) &lt;- mgis2</code></pre>
</div>
<div id="computing-natural-mortality-time-series---the-m-method" class="section level1">
<h1>Computing natural mortality time series - the <code>m()</code> method</h1>
<p>Now that we have set up the natural mortality <code>a4aM</code> model and added parameter uncertainty to each component, we are ready to generate the <code>FLQuant</code> for natural mortality. For that we need the <code>m()</code> method.</p>
<p>The <code>m()</code> method is the workhorse method for computing natural mortality. The method returns an <code>FLQuant</code> that can be inserted in an <code>FLStock</code> for usage by the assessment method.</p>
<p>The method uses the <code>range</code> slot to work out the dimensions of the <code>FLQuant</code> object. % Future developments will also allow for easy insertion into FLStockLen objects.</p>
<p>The size of the <code>FLQuant</code> object is determined by the min, max, minyear and maxyear elements of the <em>range</em> slot of the <code>a4aM</code> object. By default the values of these elements are set to 0, giving an <code>FLQuant</code> with length 1 in the <em>quant</em> and <em>year</em> dimension. The <em>range</em> slot can be set by hand, or by using the <code>rngquant()</code> and <code>rngyear()</code> methods.</p>
<p>The name of the first dimension of the output <code>FLQuant</code> (e.g. ‘age’ or ‘len’) is determined by the parameters of the <em>shape</em> model. If it is not clear what the name should be then the name is set to ‘quant’.</p>
<p>Here we demonstrate <code>m()</code> using the simple <code>a4aM</code> object we created above that has constant natural mortality.</p>
<pre class="r"><code># Start with the simplest model
m1</code></pre>
<pre><code>a4aM object:
  shape: ~1
  level: ~a
  trend: ~1</code></pre>
<pre class="r"><code># Check the range
range(m1) # no ages or years...</code></pre>
<pre><code>      min       max plusgroup   minyear   maxyear   minmbar   maxmbar 
        0         0         0         0         0         0         0 </code></pre>
<pre class="r"><code>m(m1)     # confirms no ages or years</code></pre>
<pre><code>An object of class &quot;FLQuant&quot;
An object of class &quot;FLQuant&quot;
, , unit = unique, season = all, area = unique

     year
quant 0  
    0 0.2

units:  NA </code></pre>
<pre class="r"><code># Set the quant and year ranges
range(m1, c(&#39;min&#39;, &#39;max&#39;)) &lt;- c(0,7)             # set the quant range
range(m1, c(&#39;minyear&#39;, &#39;maxyear&#39;)) &lt;- c(2000, 2010) # set the year range
range(m1)</code></pre>
<pre><code>      min       max plusgroup   minyear   maxyear   minmbar   maxmbar 
        0         7         0      2000      2010         0         0 </code></pre>
<pre class="r"><code># Show the object with the M estimates by age and year
# (note the name of the first dimension is &#39;quant&#39;)
m(m1)</code></pre>
<pre><code>An object of class &quot;FLQuant&quot;
, , unit = unique, season = all, area = unique

     year
quant 2000 2001 2002 2003 2004
    0 0.2  0.2  0.2  0.2  0.2 
    1 0.2  0.2  0.2  0.2  0.2 
    2 0.2  0.2  0.2  0.2  0.2 
    3 0.2  0.2  0.2  0.2  0.2 
    4 0.2  0.2  0.2  0.2  0.2 
    5 0.2  0.2  0.2  0.2  0.2 
    6 0.2  0.2  0.2  0.2  0.2 
    7 0.2  0.2  0.2  0.2  0.2 

      [ ...  1 years]

     year
quant 2006 2007 2008 2009 2010
    0 0.2  0.2  0.2  0.2  0.2 
    1 0.2  0.2  0.2  0.2  0.2 
    2 0.2  0.2  0.2  0.2  0.2 
    3 0.2  0.2  0.2  0.2  0.2 
    4 0.2  0.2  0.2  0.2  0.2 
    5 0.2  0.2  0.2  0.2  0.2 
    6 0.2  0.2  0.2  0.2  0.2 
    7 0.2  0.2  0.2  0.2  0.2 </code></pre>
<p>The next example has an age-based shape. As the <em>shape</em> model has ‘age’ as a variable which is not included in the <code>FLPar</code> slot, it is used as the name of the first dimension of the resulting <code>FLQuant</code>. Note that in this case, the <em>mbar</em> values in the range become relevant, once that <em>mbar</em> is used to compute the mean level. This mean level will match the value given by the <em>level</em> model. The <em>mbar</em> range can be changed with the <code>rngmbar()</code> method. We illustrate this by making an <code>FLQuant</code> with age-varying natural mortality.</p>
<pre class="r"><code># Check the model and set the ranges
m2</code></pre>
<pre><code>a4aM object:
  shape: ~exp(-age - 0.5)
  level: ~1.5 * k
  trend: ~1</code></pre>
<pre class="r"><code>range(m2, c(&#39;min&#39;, &#39;max&#39;)) &lt;- c(0,7)             # set the quant range
range(m2, c(&#39;minyear&#39;, &#39;maxyear&#39;)) &lt;- c(2000, 2010) # set the year range
range(m2)</code></pre>
<pre><code>      min       max plusgroup   minyear   maxyear   minmbar   maxmbar 
        0         7         0      2000      2010         0         0 </code></pre>
<pre class="r"><code>m(m2)</code></pre>
<pre><code>An object of class &quot;FLQuant&quot;
, , unit = unique, season = all, area = unique

   year
age 2000       2001       2002       2003       2004      
  0 0.60000000 0.60000000 0.60000000 0.60000000 0.60000000
  1 0.22072766 0.22072766 0.22072766 0.22072766 0.22072766
  2 0.08120117 0.08120117 0.08120117 0.08120117 0.08120117
  3 0.02987224 0.02987224 0.02987224 0.02987224 0.02987224
  4 0.01098938 0.01098938 0.01098938 0.01098938 0.01098938
  5 0.00404277 0.00404277 0.00404277 0.00404277 0.00404277
  6 0.00148725 0.00148725 0.00148725 0.00148725 0.00148725
  7 0.00054713 0.00054713 0.00054713 0.00054713 0.00054713

      [ ...  1 years]

   year
age 2006       2007       2008       2009       2010      
  0 0.60000000 0.60000000 0.60000000 0.60000000 0.60000000
  1 0.22072766 0.22072766 0.22072766 0.22072766 0.22072766
  2 0.08120117 0.08120117 0.08120117 0.08120117 0.08120117
  3 0.02987224 0.02987224 0.02987224 0.02987224 0.02987224
  4 0.01098938 0.01098938 0.01098938 0.01098938 0.01098938
  5 0.00404277 0.00404277 0.00404277 0.00404277 0.00404277
  6 0.00148725 0.00148725 0.00148725 0.00148725 0.00148725
  7 0.00054713 0.00054713 0.00054713 0.00054713 0.00054713</code></pre>
<pre class="r"><code># Note that the level value is
c(predict(level(m2)))</code></pre>
<pre><code>[1] 0.6</code></pre>
<pre class="r"><code># which is the same as
m(m2)[&quot;0&quot;]</code></pre>
<pre><code>An object of class &quot;FLQuant&quot;
, , unit = unique, season = all, area = unique

   year
age 2000 2001 2002 2003 2004
  0 0.6  0.6  0.6  0.6  0.6 

      [ ...  1 years]

   year
age 2006 2007 2008 2009 2010
  0 0.6  0.6  0.6  0.6  0.6 </code></pre>
<pre class="r"><code># This is because the mbar range is currently set to &quot;0&quot; and &quot;0&quot; (see above)
# and the mean natural mortality value over this range is given by the level model. 
# We can change the mbar range
range(m2, c(&#39;minmbar&#39;, &#39;maxmbar&#39;)) &lt;- c(0,7)             # set the quant range
range(m2)</code></pre>
<pre><code>      min       max plusgroup   minyear   maxyear   minmbar   maxmbar 
        0         7         0      2000      2010         0         7 </code></pre>
<pre class="r"><code># which rescales the the natural mortality at age
m(m2)</code></pre>
<pre><code>An object of class &quot;FLQuant&quot;
, , unit = unique, season = all, area = unique

   year
age 2000      2001      2002      2003      2004     
  0 3.0351969 3.0351969 3.0351969 3.0351969 3.0351969
  1 1.1165865 1.1165865 1.1165865 1.1165865 1.1165865
  2 0.4107692 0.4107692 0.4107692 0.4107692 0.4107692
  3 0.1511136 0.1511136 0.1511136 0.1511136 0.1511136
  4 0.0555916 0.0555916 0.0555916 0.0555916 0.0555916
  5 0.0204510 0.0204510 0.0204510 0.0204510 0.0204510
  6 0.0075235 0.0075235 0.0075235 0.0075235 0.0075235
  7 0.0027677 0.0027677 0.0027677 0.0027677 0.0027677

      [ ...  1 years]

   year
age 2006      2007      2008      2009      2010     
  0 3.0351969 3.0351969 3.0351969 3.0351969 3.0351969
  1 1.1165865 1.1165865 1.1165865 1.1165865 1.1165865
  2 0.4107692 0.4107692 0.4107692 0.4107692 0.4107692
  3 0.1511136 0.1511136 0.1511136 0.1511136 0.1511136
  4 0.0555916 0.0555916 0.0555916 0.0555916 0.0555916
  5 0.0204510 0.0204510 0.0204510 0.0204510 0.0204510
  6 0.0075235 0.0075235 0.0075235 0.0075235 0.0075235
  7 0.0027677 0.0027677 0.0027677 0.0027677 0.0027677</code></pre>
<pre class="r"><code># Check that the mortality over the mean range is the same as the level model
quantMeans(m(m2)[as.character(0:5)])</code></pre>
<pre><code>An object of class &quot;FLQuant&quot;
, , unit = unique, season = all, area = unique

     year
age   2000    2001    2002    2003    2004   
  all 0.79828 0.79828 0.79828 0.79828 0.79828

      [ ...  1 years]

     year
age   2006    2007    2008    2009    2010   
  all 0.79828 0.79828 0.79828 0.79828 0.79828</code></pre>
<p>The next example uses a time trend for the <em>trend</em> model. We use the m3 model we derived earlier. The <em>trend</em> model for this model has a covariate, ‘nao’. This needs to be passed to the <code>m()</code> method. The year range of the ‘nao’ covariate should match that of the <em>range</em> slot.</p>
<pre class="r"><code># Pass in a single nao value (only one year, because the trend model needs
# at least one value)
m(m3, nao=1)</code></pre>
<pre><code>An object of class &quot;FLQuant&quot;
An object of class &quot;FLQuant&quot;
, , unit = unique, season = all, area = unique

   year
age 0  
  0 0.9

units:  NA </code></pre>
<pre class="r"><code># Set ages
range(m3, c(&#39;min&#39;, &#39;max&#39;)) &lt;- c(0,7)             # set the quant range
m(m3, nao=0)</code></pre>
<pre><code>An object of class &quot;FLQuant&quot;
An object of class &quot;FLQuant&quot;
, , unit = unique, season = all, area = unique

   year
age 0         
  0 0.60000000
  1 0.22072766
  2 0.08120117
  3 0.02987224
  4 0.01098938
  5 0.00404277
  6 0.00148725
  7 0.00054713

units:  NA </code></pre>
<pre class="r"><code># With ages and years - passing in the NAO data as numeric (1,0,1,0)
range(m3, c(&#39;minyear&#39;, &#39;maxyear&#39;)) &lt;- c(2000, 2003) # set the year range
m(m3, nao=as.numeric(nao[,as.character(2000:2003)]))</code></pre>
<pre><code>An object of class &quot;FLQuant&quot;
An object of class &quot;FLQuant&quot;
, , unit = unique, season = all, area = unique

   year
age 2000       2001       2002       2003      
  0 0.90000000 0.60000000 0.90000000 0.60000000
  1 0.33109150 0.22072766 0.33109150 0.22072766
  2 0.12180175 0.08120117 0.12180175 0.08120117
  3 0.04480836 0.02987224 0.04480836 0.02987224
  4 0.01648407 0.01098938 0.01648407 0.01098938
  5 0.00606415 0.00404277 0.00606415 0.00404277
  6 0.00223088 0.00148725 0.00223088 0.00148725
  7 0.00082069 0.00054713 0.00082069 0.00054713

units:  NA </code></pre>
<p>The final example show how <code>m()</code> can be used to make an <code>FLQuant</code> with uncertainty (see Figure 3). We use the m4 object from earlier with uncertainty on the <em>level</em> and <em>trend</em> parameters.</p>
<pre class="r"><code>range(m4, c(&#39;min&#39;, &#39;max&#39;)) &lt;- c(0,7)             # set the quant range
range(m4, c(&#39;minyear&#39;, &#39;maxyear&#39;)) &lt;- c(2000, 2003)
flq &lt;- m(m4, nao=as.numeric(nao[,as.character(2000:2003)]))
flq</code></pre>
<pre><code>An object of class &quot;FLQuant&quot;
An object of class &quot;FLQuant&quot;
iters:  100 

, , unit = unique, season = all, area = unique

   year
age 2000                2001                2002               
  0 3.0079919(0.359714) 2.0389830(0.229792) 3.0079919(0.359714)
  1 1.1065784(0.132331) 0.7500999(0.084536) 1.1065784(0.132331)
  2 0.4070874(0.048682) 0.2759463(0.031099) 0.4070874(0.048682)
  3 0.1497591(0.017909) 0.1015150(0.011441) 0.1497591(0.017909)
  4 0.0550933(0.006588) 0.0373453(0.004209) 0.0550933(0.006588)
  5 0.0202677(0.002424) 0.0137386(0.001548) 0.0202677(0.002424)
  6 0.0074561(0.000892) 0.0050541(0.000570) 0.0074561(0.000892)
  7 0.0027429(0.000328) 0.0018593(0.000210) 0.0027429(0.000328)
   year
age 2003               
  0 2.0389830(0.229792)
  1 0.7500999(0.084536)
  2 0.2759463(0.031099)
  3 0.1015150(0.011441)
  4 0.0373453(0.004209)
  5 0.0137386(0.001548)
  6 0.0050541(0.000570)
  7 0.0018593(0.000210)

units:  NA </code></pre>
<pre class="r"><code>dim(flq)</code></pre>
<pre><code>[1]   8   4   1   1   1 100</code></pre>
<div class="figure" style="text-align: center">
<img src="Natural_mortality_modelling_in_FLa4a_files/figure-html/uncertain_m-1.png" alt="Natural mortality with age and year trend." width="672" />
<p class="caption">
Natural mortality with age and year trend.
</p>
</div>
</div>
<div id="references" class="section level1">
<h1>References</h1>
<p>Ernesto Jardim, Colin P. Millar, Iago Mosqueira, Finlay Scott, Giacomo Chato Osio, Marco Ferretti, Nekane Alzorriz, Alessandro Orio; What if stock assessment is as simple as a linear model? The a4a initiative. ICES J Mar Sci 2015; 72 (1): 232-236. DOI: <a href="https://doi.org/10.1093/icesjms/fsu050" class="uri">https://doi.org/10.1093/icesjms/fsu050</a></p>
<p>Kenchington, T. J. (2014), Natural mortality estimators for information-limited fisheries. Fish Fish, 15: 533-562. <a href="doi:%5B10.1111/faf.12027%5D(http://onlinelibrary.wiley.com/doi/10.1111/faf.12027)" class="uri">doi:[10.1111/faf.12027](http://onlinelibrary.wiley.com/doi/10.1111/faf.12027)</a>.</p>
<p>Colin P. Millar, Ernesto Jardim, Finlay Scott, Giacomo Chato Osio, Iago Mosqueira, Nekane Alzorriz; Model averaging to streamline the stock assessment process. ICES J Mar Sci 2015; 72 (1): 93-98. doi: <a href="https://doi.org/10.1093/icesjms/fsu043">icesjms/fsu043</a></p>
<p>Scott F, Jardim E, Millar CP, Cervino S (2016) An Applied Framework for Incorporating Multiple Sources of Uncertainty in Fisheries Stock Assessments. PLoS ONE 11(5): e0154922. doi: <a href="https://doi.org/10.1371/journal.pone.0154922">10.1371/journal.pone.0154922</a></p>
</div>
<div id="more-information" class="section level1">
<h1>More information</h1>
<p>Documentation can be found at (<a href="http://flr-project.org/FLa4a" class="uri">http://flr-project.org/FLa4a</a>). You are welcome to:</p>
<ul>
<li>Submit suggestions and bug-reports at: (<a href="https://github.com/flr/FLa4a/issues" class="uri">https://github.com/flr/FLa4a/issues</a>)</li>
<li>Send a pull request on: (<a href="https://github.com/flr/FLa4a/" class="uri">https://github.com/flr/FLa4a/</a>)</li>
<li>Compose a friendly e-mail to the maintainer, see <code>packageDescription('FLa4a')</code></li>
</ul>
<div id="software-versions" class="section level2">
<h2>Software Versions</h2>
<ul>
<li>R version 3.4.1 (2017-06-30)</li>
<li>FLCore: 2.6.5</li>
<li>FLa4a: 1.1.3</li>
<li><strong>Compiled</strong>: Mon Sep 18 10:42:43 2017</li>
</ul>
</div>
<div id="license" class="section level2">
<h2>License</h2>
<p>This document is licensed under the <a href="https://creativecommons.org/licenses/by-sa/4.0">Creative Commons Attribution-ShareAlike 4.0 International</a> license.</p>
</div>
<div id="author-information" class="section level2">
<h2>Author information</h2>
<p><strong>Ernesto Jardim</strong>. European Commission, DG Joint Research Centre, Directorate D - Sustainable Resources, Unit D.02 Water and Marine Resources, Via E. Fermi 2749, 21027 Ispra VA, Italy. <a href="https://ec.europa.eu/jrc/" class="uri">https://ec.europa.eu/jrc/</a></p>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
