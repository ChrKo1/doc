<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>FLBEIA - TUTORIAL THREE. Multi example.</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/yeti.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-1.1/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-1.1/highlight.js"></script>
<link href="site_libs/font-awesome-4.5.0/css/font-awesome.min.css" rel="stylesheet" />

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 45px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 50px;
  margin-top: -50px;
}

.section h2 {
  padding-top: 50px;
  margin-top: -50px;
}
.section h3 {
  padding-top: 50px;
  margin-top: -50px;
}
.section h4 {
  padding-top: 50px;
  margin-top: -50px;
}
.section h5 {
  padding-top: 50px;
  margin-top: -50px;
}
.section h6 {
  padding-top: 50px;
  margin-top: -50px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->






<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html"></a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="http://flr-project.org">
    <span class="fa fa-home"></span>
     
    FLR
  </a>
</li>
<li>
  <a href="index.html">
    <span class="fa fa-info"></span>
     
    Home
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-play-circle-o"></span>
     
    Intro
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="A_quick_introduction_to_FLR.html">A quick introduction to FLR</a>
    </li>
    <li>
      <a href="An_overview_of_the_FLCore_classes.html">An overview of the FLCore classes</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-database"></span>
     
    Input
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="Loading_your_data_into_FLR.html">Loading your data into FLR</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-magic"></span>
     
    Modelling
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="Modelling_stock_recruitment_with_FLSR.html">Modelling stock recruitment with FLSR</a>
    </li>
    <li>
      <a href="Statistical_catch_at_age_models_in_FLa4a.html">Statistical catch at age models in FLa4a</a>
    </li>
    <li>
      <a href="Modelling_growth_and_its_uncertainty_in_FLa4a.html">Modelling growth and its uncertainty in FLa4a</a>
    </li>
    <li>
      <a href="Natural_mortality_modelling_in_FLa4a.html">Natural mortality modelling in FLa4a</a>
    </li>
    <li>
      <a href="Stock_assessment_using_eXtended_Survivors_Analysis_with_FLXSA.html">Stock assessment using eXtended Survivors Analysis with FLXSA</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-tachometer"></span>
     
    Advice
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="Running_Medium_Term_Forecasts_with_FLash.html">Running Medium Term Forecasts with FLash</a>
    </li>
    <li>
      <a href="Short_Term_Forecasting_for_advice_using_FLash.html">Short Term Forecasting for advice using FLash</a>
    </li>
    <li>
      <a href="Forecasting_on_the_Medium_Term_for_advice_using_FLasher.html">Forecasting on the Medium Term for advice using FLasher</a>
    </li>
    <li>
      <a href="Reference_points_for_fisheries_management_with_FLBRP.html">Reference points for fisheries management with FLBRP</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-cogs"></span>
     
    MSE
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">An introduction to MSE using FLR</li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-cogs"></span>
     
    FLBEIA
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">An introduction to MSE using FLR</li>
    <li class="dropdown-header">Conditioning FLBEIA using Smart Conditioning Functions</li>
    <li class="dropdown-header">A simple example on how to use FLBEIA</li>
    <li class="dropdown-header">A simple example with multiple dimensions in FLBEIA</li>
    <li class="dropdown-header">Using Stock Assessment models in the Managemnt procedure of FLBEIA</li>
    <li class="dropdown-header">Testing different Management Strategies in FLBEIA</li>
    <li class="dropdown-header">Data Limited MSE in FLBEIA</li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-area-chart"></span>
     
    Plotting
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="ggplotFL_plotting_FLR_objects_with_ggplot2.html">ggplotFL, plotting FLR objects with ggplot2</a>
    </li>
    <li>
      <a href="Plotting_FLR_objects_using_lattice.html">Plotting FLR objects using lattice</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-puzzle-piece"></span>
     
    Internals
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="Units_of_measurement_in_FLR_objects.html">Units of measurement in FLR objects</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="http://github.com/flr/doc/issues">
    <span class="fa fa-question fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">FLBEIA - TUTORIAL THREE. Multi example.</h1>
<h4 class="date"><em>02 Oct, 2017</em></h4>

</div>


<p><img src="images/FLBEIA_logo.png" width="20%" style="display: block; margin: auto;" /></p>
<div id="aim" class="section level1">
<h1>Aim</h1>
<p><strong>FLBEIA</strong> provides a battery of tutorials for learning how to use this software. In this tutorial an example, named <strong>multi</strong> is run in <code>FLBEIA</code>. Then, the outputs of <code>FLBEIA</code> are explored, summarized and plotted. Once the user has understood the structure and outputs of <code>FLBEIA</code>, letâ€™s start playing! Several scenarios are run changing and adjusting several data and functions that <code>FLBEIA</code> provides. Scenarios are compared in order to visualize the effects of the changes done in each scenario. In the current tutorial, the scenarios will be related to the economic issues of the model.</p>
</div>
<div id="required-packages-to-run-this-tutorial" class="section level1">
<h1>Required packages to run this tutorial</h1>
<p>To follow this tutorial you should have installed the following packages</p>
<ul>
<li>CRAN: <a href="https://cran.r-project.org/web/packages/ggplot2/index.html">ggplot2</a></li>
<li>FLR: <a href="http://www.flr-project.org/FLCore/">FLCore</a>, <a href="http://www.flr-project.org/FLAssess/">FLAssess</a>, <a href="http://www.flr-project.org/FLash/">FLash</a>,<a href="http://www.flr-project.org/FLBEIA/">FLBEIA</a>, <a href="http://www.flr-project.org/FLFleet/">FLFleet</a>, <a href="http://www.flr-project.org/ggplotFL/">ggplotFL</a></li>
</ul>
<p>if you are using Windows, please use 32-bit R version because some of the packages do not work in 64-bit.</p>
<pre class="r"><code>library(devtools)
install_github(&quot;flr/FLBEIA&quot;)</code></pre>
<p>Load all necessary packages.</p>
<pre class="r"><code># This chunk loads all necessary packages.
library(FLBEIA)
library(FLXSA)
library(FLash)
library(ggplotFL)</code></pre>
</div>
<div id="example-2-stocks-2-fleets-with-two-metiers-each-4-seasons-and-1-iteration." class="section level1">
<h1>EXAMPLE: 2 stocks, 2 fleets with two metiers each, 4 seasons and 1 iteration.</h1>
<p>This dataset has 2 stocks, one stk1 is age structured and the second one stk2 is aggregated in biomass.</p>
<ul>
<li>Historic data 1990-2008 and projection 2009-2025.</li>
<li>Operating model: Population dynamics
<ul>
<li>stk1: Age Structured Population Growth. Beverton and Holt.</li>
<li>stk2: Biomass Dynamic Population Growth. Pella-Tomlinson.</li>
</ul></li>
<li>Management Procedure
<ul>
<li>Perfect observation &amp; No assesSMent</li>
</ul></li>
<li>HCR
<ul>
<li>stk1: IcesHCR</li>
<li>stk2: Annual TAC</li>
</ul></li>
<li>Fleets dynamics
<ul>
<li>fl1: Simple Mixed Fisheries Behaviour. Two metiers.</li>
<li>fl2: Fixed effort. Two metiers.</li>
</ul></li>
</ul>
<div id="load-data" class="section level2">
<h2>Load data</h2>
<pre class="r"><code>rm(list=ls())
data(multi)</code></pre>
<p>With the <code>ls()</code> command we can see the objects stored in <code>multi</code>, which are those need to call to <code>FLBEIA</code>.</p>
<pre class="r"><code>ls()</code></pre>
<pre><code>character(0)</code></pre>
<pre class="r"><code># Show the class of each of the objects.
sapply(ls(), function(x) class(get(x)))</code></pre>
<pre><code>named list()</code></pre>
</div>
<div id="run-flbeia." class="section level2">
<h2>Run FLBEIA.</h2>
<p>Run FLBEIA with multi and explore the output.</p>
<pre class="r"><code>SM &lt;- FLBEIA(biols = multiBio,       # FLBiols object with 2 FLBiol element for stk1.
               SRs = multiSR,        # A list with 1 FLSRSim object for stk1.
               BDs = multiBD,        # A list with 1 FLBDSim object for stk2.
            fleets = multiFl,        # FLFleets object with on fleet.
            covars = multiCv,        # A list with socio - economic data.         
           indices = NULL,           # Indices not available.
            advice = multiAdv,       # A list with two elements &#39;TAC&#39; and &#39;quota.share&#39;.
         main.ctrl = multiMainC,     # A list with one element to define the start/end of the simulation.
        biols.ctrl = multiBioC,      # A list with one element to select the model to simulate the stock dynamics.
       fleets.ctrl = multiFlC,       # A list with several elements to select fleet dynamic models and store additional parameters.
       covars.ctrl = multiCvC,       # Covars control (additional data for capital dynamics) 
          obs.ctrl = multiObsC,      # A list with one element to define how the stock observed (&quot;PerfectObs&quot;).
       assess.ctrl = multiAssC,      # A list with one element to define how the stock assesSMent model used (&quot;NoAssesSMent&quot;).
       advice.ctrl = multiAdvC)      # A list with one element to define how the TAC advice is obtained (&quot;IcesHCR&quot;).</code></pre>
<p>FLBEIA returns a list with several objects, letâ€™s print the names of the objects and its class</p>
<pre class="r"><code>names(SM)</code></pre>
<pre><code>[1] &quot;biols&quot;         &quot;fleets&quot;       
[3] &quot;covars&quot;        &quot;advice&quot;       
[5] &quot;stocks&quot;        &quot;indices&quot;      
[7] &quot;fleets.ctrl&quot;   &quot;pkgs.versions&quot;</code></pre>
</div>
<div id="summarizing-results" class="section level2">
<h2>Summarizing results</h2>
<p><code>FLBEIA</code> has predeterminated functions to create summary data frames (biological, economic, and catch), in two formats:</p>
<ul>
<li>Long format: where all the indicators are in the same column.There is one column, indicator, for the name of the indicator and a second one for the numeric value of the indicator.</li>
<li>Wide format: where each column correspond with one indicator. The long format it is recommendable to work with ggplot2 functions while the wide format it is more efficient for memory allocation and speed of computations.</li>
</ul>
<p>Note that in this example the <code>covars</code> object contents information on costs.</p>
<div id="long-format." class="section level3">
<h3>Long format.</h3>
<pre class="r"><code>SM_bio    &lt;- bioSum(SM)             # Data frame (DF) with the biological indicators.
SM_adv    &lt;- advSum(SM)             # DF with the indicators related with the management advice (TAC). 
SM_flt    &lt;- fltSum(SM)             # DF with the indicators at fleet level.
SM_fltStk &lt;- fltStkSum(SM)          # DF with the indicators at fleet and stock level.
SM_mt     &lt;- mtSum(SM)              # DF with the indicators at fleet.
SM_mtStk  &lt;- mtStkSum(SM)           # DF with the indicators at fleet and metier level.
SM_vessel &lt;- vesselSum(SM)          # DF with the indicators at vessel level.
SM_vesselStk &lt;- vesselStkSum(SM)    # DF with the indicators at vessel and stock level.
SM_npv  &lt;- npv(SM, y0 = &#39;2014&#39;)     # DF with the net present value per fleet over the selected range of years.
SM_risk &lt;- riskSum(SM,  Bpa= c(stk1= 135000, stk2 = 124000), Blim =c(stk1 = 96000, stk2 = 89000),
                   Prflim = c(fl1 = 0, fl2 = 0), flnms = names(SM$fleets), 
                   years = dimnames(SM$biols[[1]]@n)[[2]], scenario = &#39;SM&#39;) #  DF with the risk indicators. The indicators are: pBlim, pBpa and pPrlim.


# Exploring data frames
head(SM_bio); unique(SM_bio$indicator)
head(SM_adv); unique(SM_adv$indicator)
head(SM_flt); unique(SM_flt$indicator)
head(SM_fltStk); unique(SM_fltStk$indicator)
head(SM_mt); unique(SM_mt$indicator)
head(SM_mtStk); unique(SM_mtStk$indicator)
head(SM_vessel); unique(SM_vessel$indicator)
head(SM_vesselStk); unique(SM_vesselStk$indicator)
head(SM_risk); unique(SM_risk$indicator)</code></pre>
</div>
<div id="wide-format." class="section level3">
<h3>Wide format.</h3>
<pre class="r"><code>SM_bio_l    &lt;- bioSum(SM, long = FALSE)            
SM_adv_l    &lt;- advSum(SM, long = FALSE)             
SM_flt_l    &lt;- fltSum(SM, long = FALSE)            
SM_fltStk_l &lt;- fltStkSum(SM, long = FALSE)          
SM_mt_l     &lt;- mtSum(SM, long = FALSE)             
SM_mtStk_l  &lt;- mtStkSum(SM, long = FALSE)           
SM_vessel_l &lt;- vesselSum(SM, long = FALSE)          
SM_vesselStk_l &lt;- vesselStkSum(SM, long = FALSE) 

# Exploring data frames
head(SM_bio_l, 2)
head(SM_adv_l, 2)
head(SM_flt_l, 2)
head(SM_fltStk_l, 2)
head(SM_mt_l, 2)
head(SM_mtStk_l, 2)
head(SM_vessel_l, 2)
head(SM_vesselStk_l, 2)</code></pre>
</div>
<div id="plotting-results" class="section level3">
<h3>Plotting results</h3>
<p>You can plot the <code>FLBiol</code> object within <code>biols</code> and the <code>FLStock</code> object within <code>stock</code> using the default plots in <strong>FLCore</strong> package.</p>
<pre class="r"><code>#plot(SM$biols[[1]]) # There are too much data to display them correctly.
plot(SM$stocks[[1]])</code></pre>
<p><img src="FLBEIA_An_Example_with_multiple_dimensions_files/figure-html/unnamed-chunk-9-1.png" width="336" style="display: block; margin: auto;" /></p>
<p>Additionally you can plot objects using <code>plotFLBiols</code>, <code>plotFLFleets</code> and <code>plotCatchFl</code>. The plots will be load in your working directory by default.</p>
<pre class="r"><code># set your own working directory.
# myWD &lt;- &quot;My working directory&quot;)
# setwd(myWD)
plotFLBiols(SM$biols, pdfnm = &quot;SM&quot;)
plotFLFleets(SM$fleets, pdfnm =&quot;SM&quot;)
plotfltStkSum(SM, pdfnm =&quot;SM&quot;) 
plotEco(SM, pdfnm =&#39;SM&#39;)</code></pre>
<p>You can also desing your own plot using the function <code>ggplot</code>. In the current example we will plot the economic related outputs.</p>
<pre class="r"><code>inds &lt;- c(&#39;capacity&#39;,&#39;costs&#39;,&#39;income&#39;,&#39;profits&#39;)
d &lt;- rbind(subset(SM_flt,indicator  %in% inds ))
d$indicator &lt;- factor( d$indicator, levels=inds)
d$scenario &lt;- factor(d$scenario)
d$year &lt;- as.numeric(d$year)
p &lt;- ggplot( data=d, aes(x=year, y=value, color=fleet)) + 
  geom_line() + 
  facet_wrap(~ indicator, scales=&quot;free&quot;) + 
  geom_vline(xintercept = multiMainC$sim.years[[&#39;initial&#39;]], linetype = &quot;longdash&quot;) + 
  theme_bw() + 
  theme(text=element_text(size=10),
        title=element_text(size=10,face=&quot;bold&quot;),
        strip.text=element_text(size=10)) + 
  ylab(&quot;&quot;)
print(p)</code></pre>
<p><img src="FLBEIA_An_Example_with_multiple_dimensions_files/figure-html/unnamed-chunk-11-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="lets-play" class="section level2">
<h2>LETâ€™S PLAY</h2>
<p>In this example the economic information is available. The play will focus on economic variables, processess and indicators.</p>
<div id="price" class="section level3">
<h3>Price</h3>
<p>As you can see in the generated plots that profits are negative. Imagine that the unit of the prices are wrong, the price should be by tonnes instead by kilogram because the units of catches are tonnes. Then, we can solve the error multipliying the all prices by 1000.</p>
<pre class="r"><code>for (i in names(multiFl)) {
  for(j in names(multiFl[[i]]@metiers)) {
    for(k in names(multiFl[[i]]@metiers[[j]]@catches)) {
      multiFl[[i]]@metiers[[j]]@catches[[k]]@price &lt;- multiFl[[i]]@metiers[[j]]@catches[[k]]@price*1000
    }
  }
}  </code></pre>
<p>As this example is not a real case study, there are some values that are not coherent. We solve this situations re- condicioning this values.</p>
<pre class="r"><code># Adjusting some values.
multiFl$fl2@capacity # There is a fixed capacity from 2009 onwards, then, the number of vessels and the maxdays will be fixed in the simulation period.
multiCv$MaxDays[2,ac(2010:2025),,,] &lt;-multiCv$MaxDays[2,ac(2009),,,]
multiCv$NumbVessels[2,,,] &lt;- multiFl$fl2@capacity/multiCv$MaxDays[2,,,,]</code></pre>
<p>Run FLBEIA and generate the base case scenario.</p>
<pre class="r"><code>SM &lt;- FLBEIA(biols = multiBio,   SRs = multiSR,  BDs = multiBD, fleets = multiFl, covars = multiCv,
             indices = NULL,advice = multiAdv, main.ctrl = multiMainC, biols.ctrl = multiBioC,
             fleets.ctrl = multiFlC, covars.ctrl = multiCvC, obs.ctrl = multiObsC, assess.ctrl = multiAssC,
             advice.ctrl = multiAdvC)     </code></pre>
<div id="summary-the-results" class="section level4">
<h4>Summary the results</h4>
<pre class="r"><code>SM_bio    &lt;- bioSum(SM)             # Data frame (DF) with the biological indicators.
SM_adv    &lt;- advSum(SM)             # DF with the indicators related with the management advice (TAC). 
SM_flt    &lt;- fltSum(SM)             # DF with the indicators at fleet level.
SM_fltStk &lt;- fltStkSum(SM)          # DF with the indicators at fleet and stock level.
SM_mt     &lt;- mtSum(SM)              # DF with the indicators at fleet.
SM_mtStk  &lt;- mtStkSum(SM)           # DF with the indicators at fleet and metier level.
SM_vessel &lt;- vesselSum(SM)          # DF with the indicators at vessel level.
SM_vesselStk &lt;- vesselStkSum(SM)    # DF with the indicators at vessel and stock level.
SM_npv  &lt;- npv(SM, y0 = &#39;2014&#39;)     # DF with the net present value per fleet over the selected range of years.
SM_risk &lt;- riskSum(SM, stknms = names(SM$biols), Bpa= c(stk1= 135000, stk2 = 124000), Blim =c(stk1 = 96000, stk2 = 89000),
                   Prflim = c(fl1 = 0, fl2 = 0), flnms = names(SM$fleets), 
                   years = dimnames(SM$biols[[1]]@n)[[2]], scenario = &#39;SM&#39;) #  DF with the risk indicators. The indicators are: pBlim, pBpa and pPr</code></pre>
</div>
<div id="plots" class="section level4">
<h4>Plots</h4>
<pre class="r"><code>plotFLBiols(SM$biols, pdfnm = &quot;SM_pricex1000&quot;)
plotFLFleets(SM$fleets, pdfnm =&quot;SM_pricex1000&quot;)
plotfltStkSum(SM, pdfnm =&quot;SM_pricex1000&quot;) </code></pre>
<pre><code>png 
  2 </code></pre>
<pre class="r"><code>plotEco(SM, pdfnm =&#39;SM_pricex1000&#39;)</code></pre>
<pre><code>png 
  2 </code></pre>
<pre class="r"><code>inds &lt;- c(&#39;capacity&#39;,&#39;costs&#39;,&#39;income&#39;,&#39;profits&#39;)
d &lt;- rbind(subset(SM_flt,indicator  %in% inds ))
d$indicator &lt;- factor( d$indicator, levels=inds)
d$scenario &lt;- factor(d$scenario)
d$year &lt;- as.numeric(d$year)
p &lt;- ggplot( data=d, aes(x=year, y=value, color=fleet)) + 
  geom_line() + 
  facet_wrap(~ indicator, scales=&quot;free&quot;) + 
  geom_vline(xintercept = multiMainC$sim.years[[&#39;initial&#39;]], linetype = &quot;longdash&quot;) + 
  theme_bw() + 
  theme(text=element_text(size=10),
        title=element_text(size=10,face=&quot;bold&quot;),
        strip.text=element_text(size=10)) + 
  ylab(&quot;&quot;)
print(p)</code></pre>
<p><img src="FLBEIA_An_Example_with_multiple_dimensions_files/figure-html/unnamed-chunk-16-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Now profits are positive, this simulation will be the base case.</p>
</div>
</div>
<div id="price-dynamics" class="section level3">
<h3>Price Dynamics</h3>
<p>The current price function is <code>fixedprice</code>: prices are given as input data and are unchanged within the simulation. Now change we will change the price dynamics: we will implement an <code>elasticPrice</code> model in one fleet <code>fl1</code> and stock <code>stk2</code>. For a detailed description of this function see page 19 of the <a href="https://github.com/flr/FLBEIA/blob/master/inst/doc/FLBEIA_manual.pdf">Manual</a>. The dynamics price function implemented in FLBEIA is described in Kraak et al. [2004]. This function uses a base price and base landings to calculate the new price using an elasticity parameter. If the base landings are bigger than current landings the price is increased and decreased if the contrary occurs. Although price is stored at metier and stock level in <code>FLFleetsExt</code>,this function assumes that is common to all metiers within a fleet and it is calculated at fleet level.</p>
<pre class="r"><code># Describe the price function
multiFlC_1 &lt;- multiFlC
multiFlC_1$fl1$stk2$price.model &lt;- &quot;elasticPrice&quot; # Set the price model.

# Include the new paramenter (elasticity)
multiFl_1 &lt;- multiFl 
elasticity &lt;- 0.5 # We assume that the elasticity is 0.2.
multiFlC_1$fl1$stk2$pd.els &lt;-  array(elasticity, dim = c(1, 4, 1),
                                     dimnames= list(age = &#39;all&#39;, season = c(1:4), iter = 1)) 

# Reference landings: year 2008
La0_met1 &lt;- multiFl$fl1@metiers$met1@catches$stk2@landings.n[,as.character(2008),,,]*multiFl$fl1@metiers$met1@catches$stk2@landings.wt[,as.character(2008),,,]
La0_met2 &lt;- multiFl$fl1@metiers$met2@catches$stk2@landings.n[,as.character(2008),,,]*multiFl$fl1@metiers$met2@catches$stk2@landings.wt[,as.character(2008),,,]
pd.La0 &lt;- unitSums(La0_met1 +La0_met2) 
                   
multiFlC_1$fl1$stk2$pd.La0 &lt;- array(pd.La0, dim = c(1,4, 1),
                                   dimnames= list(age = &#39;all&#39;, season = c(1:4), iter = 1))

# Reference price
Pa0_met1 &lt;- multiFl$fl1@metiers$met1@catches$stk2@price[,as.character(2008),,,] 
Pa0_met2 &lt;- multiFl$fl1@metiers$met2@catches$stk2@price[,as.character(2008),,,]  
pd.Pa0 &lt;- unitMeans((La0_met1*Pa0_met1 +La0_met2*Pa0_met2)/(La0_met1+La0_met2))

multiFlC_1$fl1$stk2$pd.Pa0 &lt;- array(pd.Pa0,  dim = c(1,4, 1),
                                   dimnames= list(age = &#39;all&#39;, season = c(1:4), iter = 1))

multiFlC_1$fl1$stk2$pd.total &lt;- TRUE # If TRUE the price is calculated using total landings and if FALSE the landings of the fleet in question are used to estimate the price.


SM_1 &lt;- FLBEIA(biols = multiBio, SRs = multiSR, BDs = multiBD, fleets = multiFl_1,
               covars = multiCv, indices = NULL, advice = multiAdv, main.ctrl = multiMainC,
               biols.ctrl = multiBioC, fleets.ctrl = multiFlC_1, covars.ctrl = multiCvC,
               obs.ctrl = multiObsC, assess.ctrl = multiAssC, advice.ctrl = multiAdvC)</code></pre>
<p>Plot price and income to see the impact that the price dynamics have on the results.</p>
<pre class="r"><code>SM_1_fltStk &lt;- fltStkSum(SM_1, scenario =&#39;elasticPrice&#39;) 
SM_x &lt;- rbind(SM_fltStk, SM_1_fltStk)


inds &lt;- c(&#39;price&#39;, &#39;catch&#39;)
d &lt;- rbind(subset(SM_x,indicator  %in% inds &amp; fleet == &#39;fl1&#39; &amp; stock == &#39;stk2&#39;))
d$indicator &lt;- factor( d$indicator, levels=inds)
d$scenario &lt;- factor(d$scenario)
d$year &lt;- as.numeric(d$year)
p &lt;- ggplot( data=d, aes(x=year, y=value, color=scenario)) + 
  geom_line() + 
  facet_wrap(~ indicator, scales=&quot;free&quot;) + 
  geom_vline(xintercept = multiMainC$sim.years[[&#39;initial&#39;]], linetype = &quot;longdash&quot;) + 
  theme_bw() + 
  theme(text=element_text(size=10),
        title=element_text(size=10,face=&quot;bold&quot;),
        strip.text=element_text(size=10)) + 
  ylab(&quot;&quot;)
print(p)</code></pre>
<p><img src="FLBEIA_An_Example_with_multiple_dimensions_files/figure-html/unnamed-chunk-18-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="r"><code>SM_1_flt &lt;- fltSum(SM_1, scenario =&#39;elasticPrice&#39;) 
SM_x &lt;- rbind(SM_flt, SM_1_flt)
SM_x &lt;- subset(SM_x, fleet == &#39;fl1&#39;)

inds &lt;- c(&#39;capacity&#39;,&#39;costs&#39;,&#39;income&#39;,&#39;profits&#39;)
d &lt;- rbind(subset(SM_x,indicator  %in% inds ))
d$indicator &lt;- factor( d$indicator, levels=inds)
d$scenario &lt;- factor(d$scenario)
d$year &lt;- as.numeric(d$year)
p &lt;- ggplot( data=d, aes(x=year, y=value, color=scenario)) + 
  geom_line() + 
  facet_wrap(~ indicator, scales=&quot;free&quot;) + 
  geom_vline(xintercept = multiMainC$sim.years[[&#39;initial&#39;]], linetype = &quot;longdash&quot;) + 
  theme_bw() + 
  theme(text=element_text(size=10),
        title=element_text(size=10,face=&quot;bold&quot;),
        strip.text=element_text(size=10)) + 
  ylab(&quot;&quot;)
print(p)</code></pre>
<p><img src="FLBEIA_An_Example_with_multiple_dimensions_files/figure-html/unnamed-chunk-19-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="fixed-costs" class="section level3">
<h3>Fixed Costs</h3>
<p>In this example the economic information is available. Fixed costs (repair, maintenance and other) of <code>fl1</code> decreases a 80%. How does this impact the economic results?</p>
<pre class="r"><code>multiFl_2 &lt;- multiFl
multiFl_2$fl1@fcost &lt;- multiFl_2$fl1@fcost*(1-0.8)
SM_2 &lt;- FLBEIA(biols = multiBio, SRs = multiSR, BDs = multiBD, fleets = multiFl_2,
               covars = multiCv, indices = NULL, advice = multiAdv, main.ctrl = multiMainC,
               biols.ctrl = multiBioC, fleets.ctrl = multiFlC, covars.ctrl = multiCvC,
               obs.ctrl = multiObsC, assess.ctrl = multiAssC, advice.ctrl = multiAdvC) </code></pre>
<p>We can visualize the results of both simulations (SM aganist SM_2) using ggplot.</p>
<pre class="r"><code>SM_2_flt    &lt;- fltSum(SM_2, scenario = &#39;SM_2&#39;)
SM_x &lt;- rbind(SM_flt, SM_2_flt)

inds &lt;- c(&#39;costs&#39;,&#39;fcosts&#39;,&#39;income&#39;,&#39;profits&#39;)
d &lt;- rbind(subset(SM_x,indicator  %in% inds &amp; fleet == &#39;fl1&#39;))
d$indicator &lt;- factor( d$indicator, levels=inds)
d$scenario &lt;- factor(d$scenario)
d$year &lt;- as.numeric(d$year)
p &lt;- ggplot( data=d, aes(x=year, y=value, color=scenario)) + 
  geom_line() + 
  facet_wrap(~ indicator, scales=&quot;free&quot;) + 
  geom_vline(xintercept = multiMainC$sim.years[[&#39;initial&#39;]], linetype = &quot;longdash&quot;) + 
  theme_bw() + 
  theme(text=element_text(size=10),
        title=element_text(size=10,face=&quot;bold&quot;),
        strip.text=element_text(size=10)) + 
  ylab(&quot;&quot;)
print(p)</code></pre>
<p><img src="FLBEIA_An_Example_with_multiple_dimensions_files/figure-html/unnamed-chunk-21-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="variable-costs" class="section level3">
<h3>Variable Costs</h3>
<p>Variable costs decreases a 50% for <code>fl2</code> and for metiers <code>met1</code> and <code>met2</code>. How does this affect to the economic results?</p>
<pre class="r"><code>multiFl_3 &lt;- multiFl
multiFl_3$fl2@metiers$met1@vcost &lt;- multiFl_3$fl2@metiers$met1@vcost*(1-0.5)
multiFl_3$fl2@metiers$met2@vcost &lt;- multiFl_3$fl2@metiers$met2@vcost*(1-0.5)

SM_3 &lt;- FLBEIA(biols = multiBio, SRs = multiSR, BDs = multiBD, fleets = multiFl_3,
               covars = multiCv, indices = NULL, advice = multiAdv, main.ctrl = multiMainC,
               biols.ctrl = multiBioC, fleets.ctrl = multiFlC, covars.ctrl = multiCvC,
               obs.ctrl = multiObsC, assess.ctrl = multiAssC, advice.ctrl = multiAdvC) </code></pre>
<p>Compare results aganist base case scenario.</p>
<pre class="r"><code>SM_3_flt    &lt;- fltSum(SM_3, scenario = &#39;SM_3&#39;)

inds &lt;- c(&#39;costs&#39;,&#39;vcosts&#39;,&#39;income&#39;,&#39;profits&#39;)
d &lt;- rbind(subset(SM_flt,indicator  %in% inds &amp; fleet == &#39;fl2&#39;),
            subset(SM_3_flt, indicator %in% inds  &amp; fleet == &#39;fl2&#39;))
d$indicator &lt;- factor( d$indicator, levels=inds)
d$year &lt;- as.numeric(d$year)
p &lt;- ggplot( data=d, aes(x=year, y=value, color=scenario)) + 
  geom_line() + 
  facet_wrap(~ indicator, scales=&quot;free&quot;) + 
  geom_vline(xintercept = multiMainC$sim.years[[&#39;initial&#39;]], linetype = &quot;longdash&quot;) + 
  theme_bw() + 
  theme(text=element_text(size=10),
        title=element_text(size=10,face=&quot;bold&quot;),
        strip.text=element_text(size=10)) + 
  ylab(&quot;&quot;)
print(p)</code></pre>
<p><img src="FLBEIA_An_Example_with_multiple_dimensions_files/figure-html/unnamed-chunk-23-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="crewshare" class="section level3">
<h3>Crewshare</h3>
<p>Now, imagine that the crew share remuneration system changes for <code>fl1</code> and now the percentage is 50%.</p>
<pre class="r"><code>multiFl_4 &lt;- multiFl
multiFl_4$fl1@crewshare[] &lt;- 0.5

SM_4 &lt;- FLBEIA(biols = multiBio, SRs = multiSR, BDs = multiBD, fleets = multiFl_4,
               covars = multiCv, indices = NULL, advice = multiAdv, main.ctrl = multiMainC,
               biols.ctrl = multiBioC, fleets.ctrl = multiFlC, covars.ctrl = multiCvC,
               obs.ctrl = multiObsC, assess.ctrl = multiAssC, advice.ctrl = multiAdvC) </code></pre>
<p>Compare results aganist base case scenario.</p>
<pre class="r"><code>SM_4_flt    &lt;- fltSum(SM_4, scenario = &#39;SM_4&#39;)

inds &lt;- c(&#39;costs&#39;,&#39;vcosts&#39;,&#39;income&#39;,&#39;profits&#39;)
d &lt;- rbind(subset(SM_flt,indicator  %in% inds &amp; fleet == &#39;fl1&#39;),
            subset(SM_4_flt, indicator %in% inds  &amp; fleet == &#39;fl1&#39;))
d$indicator &lt;- factor( d$indicator, levels=inds)
d$year &lt;- as.numeric(d$year)
p &lt;- ggplot( data=d, aes(x=year, y=value, color=scenario)) + 
  geom_line() + 
  facet_wrap(~ indicator, scales=&quot;free&quot;) + 
  geom_vline(xintercept = multiMainC$sim.years[[&#39;initial&#39;]], linetype = &quot;longdash&quot;) + 
  theme_bw() + 
  theme(text=element_text(size=10),
        title=element_text(size=10,face=&quot;bold&quot;),
        strip.text=element_text(size=10)) + 
  ylab(&quot;&quot;)
print(p)</code></pre>
<p><img src="FLBEIA_An_Example_with_multiple_dimensions_files/figure-html/unnamed-chunk-25-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="capital-dynamics" class="section level3">
<h3>Capital dynamics</h3>
<p>The current capital function in <code>fixedCapital</code>, where the capacity and catchability are given as input data and are unchanged within the simulation. Now change the capital function and implement the <code>SCD</code> function. In this simple function catchability is not updated, it is an input parameter, and only capacity is updated depending on some economic indicators. For more detailed information of this function, see the page 20 of the <a href="https://github.com/flr/FLBEIA/blob/master/inst/doc/FLBEIA_manual.pdf">Manual</a>.</p>
<p>Firstly define neccessary variables.:</p>
<pre class="r"><code># fl1 is fixed effort
multiFlC_5 &lt;- multiFlC
multiFlC_5$fl2$capital.model &lt;- multiFlC_5$fl2$capital.model &lt;- &#39;SCD&#39;

multiFl_5 &lt;- multiFl
multiCv_5 &lt;- multiCv
multiCv_5$w1[] &lt;- 0.01  
multiCv_5$w2[] &lt;- 0.01
multiCv_5$InvestShare[] &lt;- 0.02
  
SM_5 &lt;- FLBEIA(biols = multiBio, SRs = multiSR, BDs = multiBD, fleets = multiFl_5,
                covars = multiCv_5, indices = NULL, advice = multiAdv, main.ctrl = multiMainC,
                biols.ctrl = multiBioC, fleets.ctrl = multiFlC_5, covars.ctrl = multiCvC,
                obs.ctrl = multiObsC, assess.ctrl = multiAssC, advice.ctrl = multiAdvC)</code></pre>
<p>Now, compare resutls aganist base case scenario.</p>
<pre class="r"><code>SM_5_flt    &lt;- fltSum(SM_5, scenario = &#39;SM_5&#39;)
SM_x &lt;- rbind( SM_flt, SM_5_flt )

inds &lt;- c(&quot;capacity&quot;,&#39;nVessels&#39;,&#39;effort&#39;,&#39;profits&#39;)
d &lt;- rbind(subset(SM_x,indicator  %in% inds &amp; fleet == &#39;fl2&#39;))
d$indicator &lt;- factor( d$indicator, levels=inds)
d$scenario &lt;- factor(d$scenario)
d$year &lt;- as.numeric(d$year)

p &lt;- ggplot( data=d, aes(x=year, y=value, color=scenario)) + 
  geom_line() + 
  facet_wrap(~ indicator, scales=&quot;free&quot;) + 
  geom_vline(xintercept = multiMainC$sim.years[[&#39;initial&#39;]], linetype = &quot;longdash&quot;) + 
  theme_bw() + 
  theme(text=element_text(size=10),
        title=element_text(size=10,face=&quot;bold&quot;),
        strip.text=element_text(size=10)) + 
  ylab(&quot;&quot;)
print(p)</code></pre>
<p><img src="FLBEIA_An_Example_with_multiple_dimensions_files/figure-html/unnamed-chunk-27-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>There are no differences between scenarios because in SCD investment in new vessels will only occur if the operational days of existing vessels is equal to maximum days. Additionally, data of this example is not real and there are some extrange results due to the conditioning.</p>
</div>
</div>
<div id="visualizing-results-with-flbeiaapp" class="section level2">
<h2>Visualizing results with flbeiaApp</h2>
<p>NA</p>
<pre class="r"><code>multi_simul &lt;- list(SM, SM_1, SM_2, SM_3, SM_4, SM_5)
scenarios &lt;- c(&#39;SM&#39;, &#39;SM_1&#39;, &#39;SM_2&#39;, &#39;SM_3&#39;, &#39;SM_4&#39;, &#39;SM_5&#39;) 
names(multi_simul) &lt;- scenarios

RefPts &lt;- data.frame(stock = rep(names(multi_simul[[1]][[1]]), each = 6*length(multi_simul)), 
                     scenario = rep(names(multi_simul), each = 6), 
                     indicator = rep(c(&#39;Bmsy&#39;,&#39;Fmsy&#39;, &#39;Bpa&#39;, &#39;Blim&#39;, &#39;Fpa&#39;, &#39;Flim&#39;),  2*length(multi_simul)), 
                     value = rep(c(max(seasonSums(unitSums(ssb(multiBio[[1]]))),na.rm = TRUE)*0.75,
                               0.27,
                               max(seasonSums(unitSums(ssb(multiBio[[1]]))),na.rm = TRUE)*0.5,
                               max(seasonSums(unitSums(ssb(multiBio[[1]]))),na.rm = TRUE)*0.25,
                               0.35, 0.5,
                               max(seasonSums(unitSums(ssb(multiBio[[2]]))),na.rm = TRUE)*0.75,
                               0.2,
                               max(seasonSums(unitSums(ssb(multiBio[[2]]))),na.rm = TRUE)*0.5,
                               max(seasonSums(unitSums(ssb(multiBio[[2]]))),na.rm = TRUE)*0.25,
                               0.3,0.4), length(multi_simul)))

flbeiaApp(multi_simul , RefPts = RefPts,  years = ac(1990:2025), npv.y0 = &#39;2009&#39;, npv.yrs = ac(2010:2025))</code></pre>
</div>
</div>
<div id="more-information" class="section level1">
<h1>More information</h1>
<ul>
<li>You can submit bug reports, questions or suggestions on this tutorial at <a href="https://github.com/flr/doc/issues" class="uri">https://github.com/flr/doc/issues</a>.</li>
<li>Or send a pull request to <a href="https://github.com/flr/doc/" class="uri">https://github.com/flr/doc/</a></li>
<li>For more information on the FLR Project for Quantitative Fisheries Science in R, visit the FLR webpage, <a href="http://flr-project.org" class="uri">http://flr-project.org</a>.</li>
<li>You can submit bug reports, questions or suggestions specific to <strong>FLBEIA</strong> to <a href="mailto:flbeia@azti.es">flbeia@azti.es</a>.</li>
</ul>
<div id="software-versions" class="section level2">
<h2>Software Versions</h2>
<ul>
<li>R version 3.4.1 (2017-06-30)</li>
<li>FLCore: 2.6.5</li>
<li>FLBEIA: 1.15.1</li>
<li>FLFleet: 2.6.0</li>
<li>FLash: 2.5.8</li>
<li>FLAssess: 2.6.1</li>
<li>FLXSA: 2.5.20140808</li>
<li>ggplotFL: 2.6.2</li>
<li>ggplot2: 2.2.1</li>
<li><strong>Compiled</strong>: Mon Oct 2 12:15:28 2017</li>
</ul>
</div>
<div id="license" class="section level2">
<h2>License</h2>
<p>This document is licensed under the <a href="https://creativecommons.org/licenses/by-sa/4.0">Creative Commons Attribution-ShareAlike 4.0 International</a> license.</p>
</div>
<div id="author-information" class="section level2">
<h2>Author information</h2>
<p><strong>FLBEIA TEAM</strong> AZTI. Marine Reserach Unit. Txatxarramendi Ugartea z/g, 48395, Sukarrieta, Basque Country, Spain. ** Mail** <a href="mailto:flbeia@azti.es">flbeia@azti.es</a></p>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
