<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>An introduction to MSE with FLR</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-1.1/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-1.1/highlight.js"></script>
<link href="site_libs/font-awesome-4.5.0/css/font-awesome.min.css" rel="stylesheet" />

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}

.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->






<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html"></a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="http://flr-project.org">
    <span class="fa fa-home"></span>
     
    FLR
  </a>
</li>
<li>
  <a href="index.html">
    <span class="fa fa-info"></span>
     
    Home
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-play-circle-o"></span>
     
    Intro
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="A_quick_introduction_to_FLR.html">A quick introduction to FLR</a>
    </li>
    <li>
      <a href="An_overview_of_the_FLCore_classes.html">An overview of the FLCore classes</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-database"></span>
     
    Input
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="Loading_your_data_into_FLR.html">Loading your data into FLR</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-magic"></span>
     
    Modelling
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="Modelling_stock_recruitment_with_FLSR.html">Modelling stock recruitment with FLSR</a>
    </li>
    <li>
      <a href="Statistical_catch_at_age_models_in_FLa4a.html">Statistical catch at age models in FLa4a</a>
    </li>
    <li>
      <a href="Modelling_growth_and_its_uncertainty_in_FLa4a.html">Modelling growth and its uncertainty in FLa4a</a>
    </li>
    <li>
      <a href="Natural_mortality_modelling_in_FLa4a.html">Natural mortality modelling in FLa4a</a>
    </li>
    <li>
      <a href="Stock_assessment_using_eXtended_Survivors_Analysis_with_FLXSA.html">Stock assessment using eXtended Survivors Analysis with FLXSA</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-tachometer"></span>
     
    Advice
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="Running_Medium_Term_Forecasts_with_FLash.html">Running Medium Term Forecasts with FLash</a>
    </li>
    <li>
      <a href="Short_Term_Forecasting_for_advice_using_FLash.html">Short Term Forecasting for advice using FLash</a>
    </li>
    <li>
      <a href="Forecasting_on_the_Medium_Term_for_advice_using_FLasher.html">Forecasting on the Medium Term for advice using FLasher</a>
    </li>
    <li>
      <a href="Reference_points_for_fisheries_management_with_FLBRP.html">Reference points for fisheries management with FLBRP</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-cogs"></span>
     
    MSE
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">An introduction to MSE using FLR</li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-area-chart"></span>
     
    Plotting
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="ggplotFL_plotting_FLR_objects_with_ggplot2.html">ggplotFL, plotting FLR objects with ggplot2</a>
    </li>
    <li>
      <a href="Plotting_FLR_objects_using_lattice.html">Plotting FLR objects using lattice</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-puzzle-piece"></span>
     
    Internals
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="Units_of_measurement_in_FLR_objects.html">Units of measurement in FLR objects</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="http://github.com/flr/doc/issues">
    <span class="fa fa-question fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">An introduction to MSE with FLR</h1>
<h4 class="date"><em>15 September, 2017</em></h4>

</div>


<p>Management Strategy Evaluation (MSE) is a framework for evaluating the performance of Harvest Control Rules (HCRs) against prevailing uncertainties (Punt et al. 2016). This tutorial introduces the basic steps for building a single-species MSE: conditioning the operating model, setting up the observation error model, constructing a simple model-based HCR (based on the ICES MSY approach), performing the MSE simulations (including feedback), and producing performance statistics.</p>
<div id="required-packages" class="section level2">
<h2>Required packages</h2>
<p>To follow this tutorial you should have installed the following packages:</p>
<ul>
<li>CRAN: <a href="https://cran.r-project.org/web/packages/ggplot2/index.html">ggplot2</a></li>
<li>FLR: <a href="http://www.flr-project.org/FLCore/">FLCore</a>, <a href="http://www.flr-project.org/FLCore/">FLash</a>,<a href="http://www.flr-project.org/FLCore/">FLXSA</a>,<a href="http://www.flr-project.org/FLCore/">FLBRP</a>, <a href="http://www.flr-project.org/ggplotFL/">ggplotFL</a></li>
</ul>
<p>You can do so as follows,</p>
<pre class="r"><code>install.packages(c(&quot;ggplot2&quot;))
install.packages(c(&quot;FLa4a&quot;,&quot;FLash&quot;,&quot;FLXSA&quot;,&quot;FLBRP&quot;,&quot;ggplotFL&quot;), repos=&quot;http://flr-project.org/R&quot;)</code></pre>
<pre class="r"><code># Loads all necessary packages
library(FLa4a)
library(FLash)
library(FLXSA)
library(FLBRP)
library(ggplotFL)</code></pre>
</div>
<div id="conditioning-the-operating-model" class="section level1">
<h1>CONDITIONING THE OPERATING MODEL</h1>
<p>Conditioning the operating model is a key step in building an MSE analysis, as it allows operating models to be considered “plausible” in the sense that they are consistent with observed data. In this tutorial, the a4a assessment model is fitted to the data within the <code>ple4</code> <code>FLStock</code> and <code>ple4.index</code> <code>FLIndex</code> objects to produce <code>stk</code>, the operating model <code>FLStock</code> object. An mcmc method within the a4a assessment is used to obtain parameter uncertainty, reflected in the <code>iter</code> dimension of <code>stk</code>.</p>
<p><strong>Read in stock assessment data</strong></p>
<pre class="r"><code>data(ple4)
data(ple4.index)
stk &lt;- ple4
idx &lt;- FLIndices(idx=ple4.index)</code></pre>
<p><strong>Set up the iteration and projection window parameters</strong></p>
<p>In this tutorial, 20 iterations are used along with a 12-year projection window. A 3-year period is used for to calculate averages needed for projections (e.g. mean weights, etc.).</p>
<pre class="r"><code>it &lt;- 20    # iterations
y0 &lt;- range(stk)[&quot;minyear&quot;] # initial data year
dy &lt;- range(stk)[&quot;maxyear&quot;] # final data year
iy &lt;- dy+1  # initial year of projection (also intermediate year)
ny &lt;- 12    # number of years to project from intial year
fy &lt;- dy+ny # final year
nsqy &lt;- 3   # number of years to compute status quo metrics</code></pre>
<p><strong>Fit stock assessment model a4a</strong></p>
<p>Set up the operating model (including parameter uncertainty) based on fitting the a4a assessment model to data. Reference points are obtained for a “median” <code>stk</code> (<code>stk0</code>) to mimic best estimates of reference points used in the ICES MSY approach.</p>
<pre class="r"><code># Set up the catchability submodel with a smoothing spline
# (setting up a &#39;list&#39; allows for more than one index)
qmod &lt;- list(~s(age, k=6))
# Set up the fishing mortality submodel as a tensor spline,
# which allows age and year to interact
fmod &lt;- ~te(replace(age, age&gt;9,9), year, k=c(6,8))
# Set up the MCMC parameters
mcsave &lt;- 100
mcmc &lt;- it * mcsave
# Fit the model
fit &lt;- a4aSCA(stk, idx, fmodel = fmod, qmodel = qmod, fit = &quot;MCMC&quot;, 
       mcmc = SCAMCMC(mcmc = mcmc, mcsave = mcsave, mcprobe = 0.4))
# Update the FLStock object
stk &lt;- stk + fit
# Reduce to keep one iteration only for reference points
stk0 &lt;- qapply(stk, iterMedians)</code></pre>
<p><strong>Fit stock-recruit model</strong></p>
<p>A Beverton-Holt stock-recruit model is fitted for each iteration, with residuals generated for the projection window based on the residuals from the historic period. A stock-recruit model is also fitted to the “median” stk for reference points.</p>
<pre class="r"><code># Fit the stock-recruit model
srbh &lt;- fmle(as.FLSR(stk, model=&quot;bevholt&quot;), method=&quot;L-BFGS-B&quot;, 
        lower=c(1e-6, 1e-6), upper=c(max(rec(stk)) * 3, Inf))
srbh0 &lt;- fmle(as.FLSR(stk0, model=&quot;bevholt&quot;), method=&quot;L-BFGS-B&quot;, 
         lower=c(1e-6, 1e-6), upper=c(max(rec(stk)) * 3, Inf))
# Generate stock-recruit residuals for the projection period
srbh.res &lt;- rnorm(it, FLQuant(0, dimnames=list(year=iy:fy)), mean(c(apply(residuals(srbh), 6, sd))))</code></pre>
<p><strong>Calculate reference points and set up the operating model for the projection window</strong></p>
<p>Reference points based on the “median” stk, assuming (for illustrative purposes only) that Bpa=0.5Bmsy and Blim=Bpa/1.4. The stf method is applied to the operating model stk object in order to have the necessary data (mean weights, etc.) for the projection window.</p>
<pre class="r"><code># Calculate the reference points
brp &lt;- brp(FLBRP(stk0, srbh0))
Fmsy &lt;- c(refpts(brp)[&quot;msy&quot;,&quot;harvest&quot;])
msy &lt;- c(refpts(brp)[&quot;msy&quot;,&quot;yield&quot;])
Bmsy &lt;- c(refpts(brp)[&quot;msy&quot;,&quot;ssb&quot;])
Bpa &lt;- 0.5*Bmsy
Blim &lt;- Bpa/1.4
# Prepare the FLStock object for projections
stk &lt;- stf(stk, fy-dy, nsqy, nsqy)</code></pre>
</div>
<div id="set-up-observation-error-model-elements" class="section level1">
<h1>SET UP OBSERVATION ERROR MODEL ELEMENTS</h1>
<p><strong>Estimate the index catchabilities from the a4a fit (without simulation)</strong></p>
<p>Observation error is introduced through the index catchability-at-age</p>
<pre class="r"><code># Set up the FLIndices object and populate it
# (note, FLIndices potentially has more than one index, hence the for loop)
idcs &lt;- FLIndices()
for (i in 1:length(idx)){
#   Set up FLQuants and calculate mean and sd for catchability
    lst &lt;- mcf(list(index(idx[[i]]), stock.n(stk0))) # make FLQuants same dimensions
    idx.lq &lt;- log(lst[[1]]/lst[[2]]) # log catchability of index
    idx.qmu &lt;- idx.qsig &lt;- stock.n(iter(stk,1)) # create quants
    idx.qmu[] &lt;- yearMeans(idx.lq) # allocate same mean-at-age to every year
    idx.qsig[] &lt;- sqrt(yearVars(idx.lq)) # allocate same sd-at-age to every year
#   Build index catchability based on lognormal distribution with mean and sd calculated above
    idx.q &lt;- rlnorm(it, idx.qmu, idx.qsig)
    idx_temp &lt;- idx.q * stock.n(stk)
    idx_temp &lt;- FLIndex(index=idx_temp, index.q=idx.q) # generate initial index
    range(idx_temp)[c(&quot;startf&quot;, &quot;endf&quot;)] &lt;- c(0, 0) # timing of index (as proportion of year)
    idcs[[i]] &lt;- idx_temp
}
names(idcs) &lt;- names(idx)
idx&lt;-idcs[1]</code></pre>
</div>
<div id="set-up-mse-loop" class="section level1">
<h1>SET UP MSE LOOP</h1>
<div id="needed-functions" class="section level2">
<h2>Needed Functions</h2>
<p><strong>Observation error model</strong><br />
In this tutorial, observation error is applied to the operating model population numbers to obtain an index of abundance. This is implemented through the index catchability-at-age. Observation error is added during each year of the projection window, and is therefore dealt with more easily in a function.</p>
<pre class="r"><code>o &lt;- function(stk, idx, assessmentYear, dataYears) {
    # dataYears is a position vector, not the years themselves
    stk.tmp &lt;- stk[, dataYears]
    # add small amount to avoid zeros
    catch.n(stk.tmp) &lt;- catch.n(stk.tmp) + 0.1
    # Generate the indices - just data years
    idx.tmp &lt;- lapply(idx, function(x) x[,dataYears])
  # Generate observed index
    for (i in 1:length(idx)) index(idx[[i]])[, assessmentYear] &lt;- 
    stock.n(stk)[, assessmentYear]*index.q(idx[[i]])[, assessmentYear]
  list(stk=stk.tmp, idx=idx.tmp, idx.om=idx)
}</code></pre>
<p><strong>XSA assessment model</strong></p>
<p>The assessment model used to parameterise the HCR is XSA, through <code>FLXSA</code>. This function sets the control parameters for <code>FLXSA</code> and fits the assessment.</p>
<pre class="r"><code>xsa &lt;- function(stk, idx){
  # Set up XSA settings
    control  &lt;- FLXSA.control(tol = 1e-09, maxit=99, min.nse=0.3, fse=2.0,
                              rage = -1, qage = range(stk)[&quot;max&quot;]-1, shk.n = TRUE, shk.f = TRUE,
                              shk.yrs = 5, shk.ages= 5, window = 100, tsrange = 99, tspower = 0)
  # Fit XSA
  fit &lt;- FLXSA(stk, idx, control)
  # convergence diagnostic (quick and dirty)
  maxit &lt;- c(&quot;maxit&quot; = fit@control@maxit)
  # Update stk
  stk   &lt;- transform(stk, harvest = harvest(fit), stock.n = stock.n(fit))
  return(list(stk = stk, converge = maxit))
}</code></pre>
<p><strong>Control object for projections</strong></p>
<p>The <code>fwd</code> method from <code>FLash</code> needs a control object, which is set by this function.</p>
<pre class="r"><code>getCtrl &lt;- function(values, quantity, years, it){
    dnms &lt;- list(iter=1:it, year=years, c(&quot;min&quot;, &quot;val&quot;, &quot;max&quot;))
    arr0 &lt;- array(NA, dimnames=dnms, dim=unlist(lapply(dnms, length)))
    arr0[,,&quot;val&quot;] &lt;- unlist(values)
    arr0 &lt;- aperm(arr0, c(2,3,1))
    ctrl &lt;- fwdControl(data.frame(year=years, quantity=quantity, val=NA))
    ctrl@trgtArray &lt;- arr0
    ctrl
}</code></pre>
</div>
<div id="mse-initialisation" class="section level2">
<h2>MSE initialisation</h2>
<p>The first year of the projection window is the intermediate year, for which, following the ICES WG timeline, already has a TAC. For this tutorial, the TAC in the final year of data is assumed to be the realised catch in <code>stk</code> for the same year, while the TAC in the intermediate year is set equal to the TAC in the final year of data. The <code>stk</code> object then needs to be projected through the intermediate year by applying the TAC in the intermediate year with <code>fwd</code>.</p>
<pre class="r"><code>vy &lt;- ac(iy:fy)
TAC &lt;- FLQuant(NA, dimnames=list(TAC=&quot;all&quot;, year=c(dy,vy), iter=1:it))
TAC[,ac(dy)] &lt;- catch(stk)[,ac(dy)]
TAC[,ac(iy)] &lt;- TAC[,ac(dy)] #assume same TAC in the first intermediate year
ctrl &lt;- getCtrl(c(TAC[,ac(iy)]), &quot;catch&quot;, iy, it)
# Set up the operating model FLStock object
stk.om &lt;- fwd(stk, control=ctrl, sr=srbh, sr.residuals = exp(srbh.res), sr.residuals.mult = TRUE)</code></pre>
</div>
<div id="start-the-mse-loop" class="section level2">
<h2>Start the MSE loop</h2>
<p>The MSE loop requires the following:</p>
<ul>
<li>observation error model to be applied to generate the index of abundance,</li>
<li>the stock assessment (XSA) to be applied using this index to generate the management procedure stock object <code>stk.mp</code>,</li>
<li>the resultant SSB estimate to be used in the HCR, along with the reference points obtained earlier, to derive target Fs for the TAC year (the year after the intermediate year), and</li>
<li>the TAC associated with the target F to be calculated by applying <code>fwd</code> to the <code>stk.mp</code>.</li>
</ul>
<p>The final step of the MSE loop is to apply the TAC to the operating model stock object, <code>stk.om</code>, by using <code>fwd</code>.</p>
<pre class="r"><code>set.seed(231) # set seed to ensure comparability between different runs
for(i in vy[-length(vy)]){
  # set up simulations parameters
    ay &lt;- an(i)
    cat(i, &quot; &gt; &quot;)
  flush.console()
    vy0 &lt;- 1:(ay-y0) # data years (positions vector) - one less than current year
    sqy &lt;- (ay-y0-nsqy+1):(ay-y0) # status quo years (positions vector) - one less than current year

  # apply observation error
    oem &lt;- o(stk.om, idx, i, vy0)
    stk.mp &lt;- oem$stk
    idx.mp &lt;- oem$idx
    idx &lt;- oem$idx.om

  # perform assessment
  out.assess &lt;- xsa(stk.mp, idx.mp)
  stk.mp &lt;- out.assess$stk
  
  # apply ICES MSY-like Rule to obtain Ftrgt
  # (note this is not the ICES MSY rule, but is similar)
  flag &lt;- ssb(stk.mp)[,ac(ay-1)]&lt;Bpa
  Ftrgt &lt;- ifelse(flag,ssb(stk.mp)[,ac(ay-1)]*Fmsy/Bpa,Fmsy) 

  # project the perceived stock to get the TAC for ay+1
  fsq.mp &lt;- yearMeans(fbar(stk.mp)[,sqy]) # Use status quo years defined above
  ctrl &lt;- getCtrl(c(fsq.mp, Ftrgt), &quot;f&quot;, c(ay, ay+1), it)
  stk.mp &lt;- stf(stk.mp, 2)
  gmean_rec &lt;- c(exp(yearMeans(log(rec(stk.mp)))))
  stk.mp &lt;- fwd(stk.mp, control=ctrl, sr=list(model=&quot;mean&quot;, params = FLPar(gmean_rec,iter=it)))
  TAC[,ac(ay+1)] &lt;- catch(stk.mp)[,ac(ay+1)]

  # apply the TAC to the operating model stock
  ctrl &lt;- getCtrl(c(TAC[,ac(ay+1)]), &quot;catch&quot;, ay+1, it)
  stk.om &lt;- fwd(stk.om, control=ctrl,sr=srbh, sr.residuals = exp(srbh.res), sr.residuals.mult = TRUE)
}</code></pre>
</div>
</div>
<div id="performance-statistics" class="section level1">
<h1>PERFORMANCE STATISTICS</h1>
<pre class="r"><code>#Some example performance statstics, but first isolate the projection period
stk.tmp&lt;-window(stk.om,start=iy)
# annual probability of being below Blim
(risky&lt;-iterSums(ssb(stk.tmp)/Blim&lt;1)/it)</code></pre>
<pre><code>An object of class &quot;FLQuant&quot;
, , unit = unique, season = all, area = unique

     year
age   2009 2010 2011 2012 2013
  all 1.00 1.00 0.90 0.50 0.05

      [ ...  2 years]

     year
age   2016 2017 2018 2019 2020
  all 0    0    0    0    0   </code></pre>
<pre class="r"><code># mean probabiity of being below Blim in the first half of the projection period
mean(risky[,1:trunc(length(risky)/2)])</code></pre>
<pre><code>[1] 0.575</code></pre>
<pre class="r"><code># ...and second half
mean(risky[,(trunc(length(risky)/2)+1):length(risky)])</code></pre>
<pre><code>[1] 0</code></pre>
<pre class="r"><code># plot of SSB relative to Bmsy
boxplot(data~year,data=as.data.frame(ssb(stk.tmp)),main=&quot;SSB&quot;)
abline(h=Bmsy,col=&quot;red&quot;)</code></pre>
<p><img src="An_introduction_to_MSE_using_FLR_files/figure-html/pstats-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="r"><code># plot of landings relative to MSY yield
boxplot(data~year,data=as.data.frame(landings(stk.tmp)),main=&quot;Landings&quot;)
abline(h=msy,col=&quot;red&quot;)</code></pre>
<p><img src="An_introduction_to_MSE_using_FLR_files/figure-html/pstats-2.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="r"><code>plot(FLStocks(stk.om=stk.om, stk.mp=stk.mp)) + theme(legend.position=&quot;top&quot;) + geom_vline(aes(xintercept=2009))</code></pre>
<div class="figure" style="text-align: center">
<img src="An_introduction_to_MSE_using_FLR_files/figure-html/fig1-1.png" alt="Results for applying an ICES MSY-like rule, comparing the operating model to the management procedure" width="672" />
<p class="caption">
Results for applying an ICES MSY-like rule, comparing the operating model to the management procedure
</p>
</div>
</div>
<div id="references" class="section level1">
<h1>References</h1>
<p>Punt, A.E., Butterworth, D.S., de Moor, C.L., De Oliveira, J.A.A. and M. Haddon (2016). Management Strategy Evaluation: Best Practices. Fish and Fisheries, 17(2): 303-334. DOI: 10.1111/faf.12104.</p>
</div>
<div id="more-information" class="section level1">
<h1>More information</h1>
<ul>
<li>You can submit bug reports, questions or suggestions on this tutorial at <a href="https://github.com/flr/doc/issues" class="uri">https://github.com/flr/doc/issues</a>.</li>
<li>Or send a pull request to <a href="https://github.com/flr/doc/" class="uri">https://github.com/flr/doc/</a></li>
<li>For more information on the FLR Project for Quantitative Fisheries Science in R, visit the FLR webpage, <a href="http://flr-project.org" class="uri">http://flr-project.org</a>.</li>
</ul>
<div id="software-versions" class="section level2">
<h2>Software Versions</h2>
<ul>
<li>R version 3.4.1 (2017-06-30)</li>
<li>FLCore: 2.6.5</li>
<li>ggplotFL: 2.6.1</li>
<li>ggplot2: 2.2.1</li>
<li><strong>Compiled</strong>: Fri Sep 15 15:43:55 2017</li>
</ul>
</div>
<div id="license" class="section level2">
<h2>License</h2>
<p>This document is licensed under the <a href="https://creativecommons.org/licenses/by-sa/4.0">Creative Commons Attribution-ShareAlike 4.0 International</a> license.</p>
</div>
<div id="author-information" class="section level2">
<h2>Author information</h2>
<p><strong>Jose DE OLIVEIRA</strong>. Centre for Environment, Fisheries and Aquaculture Science (CEFAS), Pakefield Road, Lowestoft, Suffolk NR33 0HT, United Kingdom. <a href="http://www.cefas.co.uk/" class="uri">http://www.cefas.co.uk/</a></p>
<p><strong>Iago MOSQUEIRA</strong>. European Commission, DG Joint Research Centre, Directorate D - Sustainable Resources, Unit D.02 Water and Marine Resources, Via E. Fermi 2749, 21027 Ispra VA, Italy. <a href="https://ec.europa.eu/jrc/" class="uri">https://ec.europa.eu/jrc/</a></p>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
