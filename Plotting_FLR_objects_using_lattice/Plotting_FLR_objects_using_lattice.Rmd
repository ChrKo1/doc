---
title: PLOTTING FLR OBJECTS USING LATTICE
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  github_document
tags:
license: Creative Commons CC-BY SA
---
 
```{r, ini, echo=FALSE, results='hide', message=FALSE}
# This chunk set the document environment, so it is hidden
library(knitr)
opts_chunk$set(fig.align='center',
  message=FALSE, warning=FALSE, echo=TRUE, cache=FALSE)
set.seed(1423)
```

The lattice package (Sarkar, 2008) improves on base R graphics by providing better defaults and the ability to easily display multivariate relationships. In particular, the package supports the creation of trellis graphs - graphs that display a variable or the relationship between variables, conditioned on one or more other variables. Lattice methods (e.g. xyplot(), bwplot(), dotplot()) are available for FLR classes in FLCore, and the standard plots (plot()) in FLR are lattice-based.

## Required packages

To follow this tutorial you should have installed the following packages:

- CRAN: [lattice](https://cran.r-project.org/web/packages/lattice/index.html)
- FLR: [FLCore](http://www.flr-project.org/FLCore/)

You can do so as follows:
```{r, eval=FALSE}
install.packages(c("lattice"))
install.packages(c("FLCore"), repos="http://flr-project.org/R")
```

Load necessary packages:
```{r, pkgs}
library(FLCore)
library(lattice)
```

# GRAPH TYPES AVAILABLE

The typical formula for lattice plots is `graphtype(formula, data=FLQuant)`

where *graphtype* is selected from the list below. Formula specifies the variable(s) to display and any conditioning variables. For example  `~ data | A` means display numeric variable for each level of factor A. `data ~ A` means display the relationship between numeric variables for factor A levels. `~ x` means display the numeric variable `x` alone. 

The following lattice graph options could be used for FLR objects: 

Graph Type | Description        | Formula
-----------|------------------- |---------
bwplot     | boxplot            | data~A
dotplot    | dotplot            | data~A
histogram  | histogram          | ~data|A
xyplot     | scatterplot        | data~A
wireframe  | 3D wireframe graph | data~A*B
bubbles    | bubble plot        | A~B

In case of lattice based *plot* simply the name of the object could be used, e.g. `plot(ple4)`

# STANDARD LATTICE BASED FLR PLOTS

The standard plot() function in FLR returns lattice-based plots for FLR objects.  
In the following examples, the FLStock object *ple4* and the FLSR object *nsher* are used.

```{r figA}
## Import your data from FLR
#place in the North Sea
data(ple4)
data(nsher)
```

Plots of the main FLQuants of an FLStock can be generated using the plot() function

```{r fig1}
# Plot FLStock
plot(ple4)
```

A specific object (FLQuant) of the FLStock can be also plotted by age and year using the plot() function.

```{r fig2}
# plot FLQuant
plot(catch.n(ple4)/1000, ylab="Catch numbers (thousands)")
```

The plot() function can be also used to produce summary graphs of objects other then FLStock, such as FLSR objects.

```{r fig3}
# Plot FLSR
print(plot(nsher))
```

# PLOTTING FLR OBJECTS USING LATTICE

To plot FLR objects with lattice the conversion to data.frame required to select columns names for dims and FL variable ('data') to plot. It is usefull to check how your object looks like before plotting it.

```{r fig4}
head(as.data.frame(catch(ple4)))
```


## XYPLOTS for FLR

xyplot produces bivariate scatterplots or time-series plots for FL objects. Standard features, e.g. division by number could be used in order to update standard FLR unit of measurement if needed.

Use lattice options from [user guide](https://cran.r-project.org/web/packages/lattice/lattice.pdf) to update your graphs as needed.

```{r fig5}
xyplot(data/1000~year, data=catch(ple4), type='b', pch=19,
       ylab="catch, 1000 tonnes")

```

You could also group your data, e.g. by age/area or season and plot your FLQuant by age class, area or season if needed.

```{r fig6}
xyplot(data/1000~year, groups=age, data=catch.n(ple4), type='l', 
  auto.key=list(space='bottom',columns=5, cex=0.7),
  ylab='Catch at age (10^6 units)')
```

Or analyse your groups by plotting them separately 

```{r fig7}
xyplot(data/1000~year|age, data=catch.n(ple4), type='l', ylab='Catch (10^6)')
```

Methods are also available for plotting multiple fisheries specific calculations results with elements names variable 'qname'

```{r fig8}
xyplot(data~year|qname, data=FLQuants(SSB=ssb(ple4), Yield=catch(ple4), Landings=landings(ple4)),
       type='l')
```



## BWPLOTS

```{r fig10}
bwplot(data~year, rlnorm(200, fbar(ple4), 0.15),scales=list(x=list(rot=90)))

```

## DOTPLOTS

```{r fig11}

dotplot(data~year, groups=age, harvest(ple4),
        scales=list(x=list(rot=90)),
        	ylab="F at age")

```

## HISTOGRAM

```{r fig12}
histogram(~data|year, catch.n(ple4))

```




## WIREFRAME

Three-dimensional surface plots could also be used for for plotting FLQuants.

```{r fig14}
wireframe(data~age*year, data=harvest(ple4),zlab="F")
```


# FLR specific plots BUBBLES

The bubble plots are created specially for FLR and are used to analise data by age classes. 

```{r fig15}
bubbles(age~year, data=catch.n(ple4), bub.scale=5)

```
One could also specify parts of the object of interest, e.g. select age classes between 5 and 10 as following:

```{r fig16}
bubbles(age~year, data=catch.n(ple4)[5:10,], bub.scale=10)

```

# References
[Package "lattice" user manual](https://cran.r-project.org/web/packages/lattice/lattice.pdf)  
[Quick Lattice Graphs](http://statmethods.net/advgraphs/trellis.html)  
[A quick introduction to FLR](http://doc.flr-project.org/A_quick_introduction_to_FLR.html)


# More information

* You can submit bug reports, questions or suggestions on this tutorial at <https://github.com/flr/doc/issues>.
* Or send a pull request to <https://github.com/flr/doc/>
* For more information on the FLR Project for Quantitative Fisheries Science in R, visit the FLR webpage, <http://flr-project.org>.

## Software Versions

* `r version$version.string`
* FLCore: `r packageVersion('FLCore')`
* lattice: `r packageVersion('lattice')`
* **Compiled**: `r date()`

## License

This document is licensed under the [Creative Commons Attribution-ShareAlike 4.0 International](https://creativecommons.org/licenses/by-sa/4.0) license.

## Author information

**Iago MOSQUEIRA**. European Commission Joint Research Centre (JRC), Institute for the Protection and Security of the Citizen (IPSC), Maritime Affairs Unit, Via E. Fermi 2749, 21027 Ispra VA, Italy. <https://ec.europa.eu/jrc/>
