fl1.met2.stk2_landings.n.flq <- as.FLQuant(read.csv(file = 'data/fl1.met2.stk2_landings.n.csv'))
fl2_effort.flq   <- as.FLQuant(read.csv(file = 'data/fl2_effort.csv'))
fl2_capacity.flq <- as.FLQuant(read.csv(file = 'data/fl2_capacity.csv'))
fl2_fcost.flq    <- as.FLQuant(read.csv(file = 'data/fl2_fcost.csv'))
fl2.met1_effshare.flq <- as.FLQuant(read.csv(file = 'data/fl2.met1_effshare.csv'))
fl2.met2_effshare.flq <- as.FLQuant(read.csv(file = 'data/fl2.met2_effshare.csv'))
fl2.met1_vcost.flq    <- as.FLQuant(read.csv(file = 'data/fl2.met1_vcost.csv'))
fl2.met2_vcost.flq    <- as.FLQuant(read.csv(file = 'data/fl2.met2_vcost.csv'))
fl2.met1.stk1_landings.n.flq <- as.FLQuant(read.csv(file = 'data/fl2.met1.stk1_landings.n.csv'))
fl2.met2.stk1_landings.n.flq <- as.FLQuant(read.csv(file = 'data/fl2.met2.stk1_landings.n.csv'))
fl2.met1.stk2_landings.n.flq <- as.FLQuant(read.csv(file = 'data/fl2.met1.stk2_landings.n.csv'))
fl2.met2.stk2_landings.n.flq <- as.FLQuant(read.csv(file = 'data/fl2.met2.stk2_landings.n.csv'))
fl2.met1.stk1_discards.n.flq <- as.FLQuant(read.csv(file = 'data/fl2.met1.stk1_discards.n.csv'))
fl2.met2.stk1_discards.n.flq <- as.FLQuant(read.csv(file = 'data/fl2.met2.stk1_discards.n.csv'))
fl2.met1.stk2_discards.n.flq <- as.FLQuant(read.csv(file = 'data/fl2.met1.stk2_discards.n.csv'))
fl2.met2.stk2_discards.n.flq <- as.FLQuant(read.csv(file = 'data/fl2.met2.stk2_discards.n.csv'))
# Cobb Douglas parameters estimates by default in the function create.fleets.data
# when the stock is age structured
#       alpha=1, beta=1,q=Catches/N*E
#
# Cobb Douglas parameters estimates by default in the function create.fleets.data
#  when the stock is in biomass, therefore it is necessary to include
#  the historical gB data
#       alpha=1, beta=1,q=Catches/(B+gB)*E
stk2_gB.flq <- FLQuant(dimnames = list(age = 'all', year = first.yr:(proj.yr-1), unit = stk2.unit,
season = 1:ns, iter = 1:ni))
first.yr <- 1990
proj.yr <- 2009
p <- 1
r <- 1.185527
K <- 89490
stk2.biomass <- as.FLQuant(read.csv(file = 'data/stk2_biomass.csv'))
for(ss in 1:ns){
biomass <- as.vector(stk2.biomass[, as.character(first.yr:(proj.yr-1)),,ss,])
bprod = biomass * (r/p) * (1 - (biomass/K)^p)
stk2_gB.flq[,as.character(first.yr:(proj.yr-1)),,ss,] <- bprod
}
#         Projection
#==============================================================================
#         fleets: fl1
#==============================================================================
fl1_proj.avg.yrs           <- c(2003:2005)
fl1.met1_proj.avg.yrs      <- c(2003:2005)
fl1.met2_proj.avg.yrs      <- c(2003:2005)
fl1.met1.stk1_proj.avg.yrs <- c(2003:2005)
fl1.met1.stk2_proj.avg.yrs <- c(2003:2005)
fl1.met2.stk1_proj.avg.yrs <- c(2003:2005)
fl1.met2.stk2_proj.avg.yrs <- c(2003:2005)
#==============================================================================
#         fleets: fl2
#==============================================================================
fl2_proj.avg.yrs           <- c(2005,2007,2008)
fl2.met1_proj.avg.yrs      <- c(2005,2007,2008)
fl2.met2_proj.avg.yrs      <- c(2005,2007,2008)
fl2.met1.stk1_proj.avg.yrs <- c(2005,2007,2008)
fl2.met2.stk1_proj.avg.yrs <- c(2005,2007,2008)
fl2.met1.stk2_proj.avg.yrs <- c(2005,2007,2008)
fl2.met2.stk2_proj.avg.yrs <- c(2005,2007,2008)
#  COBB douglas parameters
#==============================================================================
#              FLBEIA input object: fleets
#==============================================================================
fls.data <- list(fl1=ls(pattern="^fl1"),fl2=ls(pattern="^fl2"))
stks.data <- list(stk1=ls(pattern="^stk1"),stk2=ls(pattern="^stk2"))
fleets   <- create.fleets.data(yrs,ns,ni,fls.data,stks.data)
for(fl in names(fleets)){
fleets[[fl]]@fcost[] <- rnorm(prod(dim(fleets[[1]]@crewshare)), 5000,500)
fleets[[fl]]@fcost[] <- rnorm(prod(dim(fleets[[2]]@crewshare)), 1000,10)
fleets[[fl]]@crewshare[] <- rnorm(prod(dim(fleets[[1]]@crewshare)), .25,.025)
fleets[[fl]]@metiers[[1]]@vcost[] <- rnorm(prod(dim(fleets[[1]]@crewshare)), 1000,100)
fleets[[fl]]@metiers[[2]]@vcost[] <- rnorm(prod(dim(fleets[[2]]@crewshare)), 800,80)
fleets[[fl]]@metiers[[1]]@catches[[1]]@price[] <- rnorm(length(c(fleets[[fl]][[1]][[1]]@price)),2500,250)
fleets[[fl]]@metiers[[1]]@catches[[2]]@price[] <- rnorm(length(c(fleets[[fl]][[1]][[2]]@price)),2500,250)
fleets[[fl]]@metiers[[2]]@catches[[1]]@price[] <- rnorm(prod(dim(fleets[[fl]][[2]][[1]]@price)),1800,180)
fleets[[fl]]@metiers[[2]]@catches[[2]]@price[] <- rnorm(prod(dim(fleets[[fl]][[2]][[2]]@price)),800,80)
}
plotFLFleets(fleets,pdfnm='s0')
#==============================================================================
#  Section 8:       SRs
#==============================================================================
stk1_sr.model        <- 'bevholt'
stk1_params.n        <- 2
stk1_params.array    <- xtabs2(data~param+year+season+iter,
data=read.csv(file = 'data/stk1_params.csv'),exclude=NULL,na.action=na.pass)
stk1_params.name     <- c('a','b')
stk1_rec.flq         <- as.FLQuant(read.csv(file = 'data/stk1_rec.csv'))
stk1_ssb.flq         <- as.FLQuant(read.csv(file = 'data/stk1_ssb.csv'))
stk1_uncertainty.flq <- as.FLQuant(read.csv(file = 'data/stk1_uncertainty.csv'))
stk1_proportion.flq  <- as.FLQuant(read.csv(file = 'data/stk1_proportion.csv'))
stk1_prop.avg.yrs    <- ac(2006:2008)
stk1_timelag.matrix  <- matrix(c(0,1),2,ns, dimnames = list(c('year', 'season'),season = 1:ns))
#==============================================================================
#              FLBEIA input object: SRs
#==============================================================================
stks.data <- list(stk1=ls(pattern="^stk1"))
SRs      <- create.SRs.data(yrs,ns,ni,stks.data)
#==============================================================================
#  Section 9:       BDs
#==============================================================================
stk2_bd.model        <- 'PellaTom'
stk2_params.name     <- c('K','p','r')
stk2_params.array    <- xtabs2(data~param+year+season+iter,
data=read.csv(file = 'data/stk2_params.csv'),exclude=NULL,na.action=na.pass)
stk2_biomass.flq     <- as.FLQuant(read.csv(file = 'data/stk2_biomass.csv'))
stk2_catch.flq       <- as.FLQuant(read.csv(file = 'data/stk2_catch.csv'))
stk2_uncertainty.flq <- as.FLQuant(read.csv(file = 'data/stk2_uncertainty.csv'))
stk2_alpha  <- array(1,dim=c(length(first.yr:last.yr),ns,ni))
#    stk2_gB.flq     already defined in line 327
# Calculate gB in the biomass dynamic population
#==============================================================================
#              FLBEIA input object: BDs
#==============================================================================
stks.data <- list(stk2=ls(pattern="^stk2"))
BDs       <- create.BDs.data(yrs,ns,ni,stks.data)
BDs$stk2@alpha    <- array((BDs$stk2@params['p',,,]/BDs$stk2@params['r',,,]+1)^(1/ BDs$stk2@params['p',,,]), dim = c(length(first.yr:last.yr),4,1))
for(y in 2:19){
for(s in 1:4){
BDs[[1]] <- FLBEIA:::BDsim(BDs[[1]], year = y, season = s)
}}
#==============================================================================
#  Section 10:       advice:TAC/TAE/quota.share
#==============================================================================
stk1_advice.TAC.flq   <- as.FLQuant(read.csv(file = 'data/stk1.tac.csv'))
stk1_advice.avg.yrs   <- c(2006:2008)
stk2_advice.TAC.flq   <- as.FLQuant(read.csv(file = 'data/stk2.tac.csv'))
stk2_advice.avg.yrs   <- c(2006:2008)
#==============================================================================
#              FLBEIA input object: advice
#==============================================================================
stks.data <- list(stk1=ls(pattern="^stk1"),stk2=ls(pattern="^stk2"))
advice   <- create.advice.data(yrs,ns,ni,stks.data,fleets)
#==============================================================================
#  Section 11:       main.ctrl
#==============================================================================
main.ctrl           <- list()
main.ctrl$sim.years <- c(initial = proj.yr, final = last.yr)
#==============================================================================
#  Section 12:       biols.ctrl
#==============================================================================
growth.model     <- c('ASPG','BDPG')
biols.ctrl       <- create.biols.ctrl (stksnames=stks,growth.model=c('ASPG','BDPG'))
#==============================================================================
#  Section 13:       fleets.ctrl
#==============================================================================
n.fls.stks      <- c(2,2)
fls.stksnames   <- rep(c('stk1','stk2'),2)
effort.models    <- c('fixedEffort','SMFB')
effort.restr.fl2 <- 'min'
restriction.fl2  <- 'catch'
catch.models     <- rep(c("CobbDouglasAge", "CobbDouglasBio"),2)
capital.models   <- rep('fixedCapital',2)
price.models     <- NULL
flq.stk1<- FLQuant(dimnames = list(age = 'all', year = first.yr:last.yr, unit = stk1.unit,
season = 1:ns, iter = 1:ni))
fleets.ctrl      <- create.fleets.ctrl(fls=fls,n.fls.stks=n.fls.stks,fls.stksnames=fls.stksnames,
effort.models= effort.models, catch.models=catch.models,
capital.models=capital.models, price.models=price.models,flq=flq.stk1,
effort.restr.fl2 = effort.restr.fl2, restriction.fl2 = restriction.fl2)
fleets.ctrl$fl1$restriction <- "landings"
fleets.ctrl$fl2$restriction <- "landings"
#==============================================================================
#  Section 14:       advice.ctrl
#==============================================================================
HCR.models       <- c('IcesHCR','annualTAC')
Ftarget.stk2     <- 0.3
ref.pts.stk1     <- matrix(c(0.24, 50000, 150000), 3,ni, dimnames = list(c('Fmsy', 'Blim', 'Btrigger'), 1:ni))
advice.ctrl      <- create.advice.ctrl(stksnames = stks, HCR.models =  HCR.models,
ref.pts.stk1 = ref.pts.stk1, Ftarget.stk2 = Ftarget.stk2,first.yr=first.yr,last.yr=last.yr)
advice.ctrl[['stk1']][['sr']]            <- list()
advice.ctrl[['stk1']][['sr']][['model']] <- 'segreg'
advice.ctrl[['stk1']][['sr']][['years']] <- c(y.rm = 2, num.years = 10)
advice.ctrl$stk1$AdvCatch <- rep(TRUE,length(first.yr:last.yr))   #TRUE advice in catches, FALSE advice in landings
names(advice.ctrl$stk1$AdvCatch) <- as.character((first.yr:last.yr))
#==============================================================================
#  Section 15:       assess.ctrl
#==============================================================================
assess.models    <- rep('NoAssessment',2)
assess.ctrl      <- create.assess.ctrl(stksnames = stks, assess.models = assess.models)
#==============================================================================
#  Section 16:       obs.ctrl
#==============================================================================
stkObs.models    <- rep('perfectObs',2)
obs.ctrl         <- create.obs.ctrl(stksnames = stks,  stkObs.models = stkObs.models)
#==============================================================================
#  Section 17:       covars
#==============================================================================
#
load(file="covars.data.RData")
covars <- vector("list",9)
names(covars)<-c("FuelCost","CapitalCost","Salaries", "InvestShare","NumbVessels","MaxDays",
"w1","w2","EmploymentPerVessel")
flq <- FLQuant(rnorm(length(fls)*length(first.yr:last.yr)*ns*ni, 1000,100),dimnames = list(fleets = fls, year = first.yr:last.yr, unit = stk1.unit,
season = 1:ns, iter = 1:ni))
for(cv in names(covars)){
covars[[cv]] <- flq
dimnames(covars[[cv]])[[1]] <- c('fl1', 'fl2')
covars[[cv]][] <- rnorm(prod(dim(flq)), covars.tesis[[cv]][1, '2016'],covars.tesis[[cv]][1, '2016']*0.1)
}
#==============================================================================
#  Section 18:       covars.ctrl
#==============================================================================
covars.ctrl <- vector("list",9)
names(covars.ctrl)<-c("FuelCost","CapitalCost","Salaries", "InvestShare","NumbVessels","MaxDays",
"w1","w2","EmploymentPerVessel")
for(cv in names(covars)){
covars.ctrl[[cv]] <- list()
covars.ctrl[[cv]][['process.model']]  <- 'fixedCovar'
}
#==============================================================================
#  Section 18:       FLBEIA input objects
#==============================================================================
indices <- NULL
#==============================================================================
#       Rename
#==============================================================================
multiAdv  <- advice
multiAdvC <- advice.ctrl
multiAssC <- assess.ctrl
multiBio  <-  biols
multiBioC <- biols.ctrl
multiFl   <- fleets
multiFlC  <- fleets.ctrl
multiMainC <- main.ctrl
multiObsC  <-  obs.ctrl
multiSR    <- SRs
multiCv <- covars
multiCvC <- covars.ctrl
multiBD <- BDs
save(multiBio,multiSR, multiBD,fleets = multiFl, multiCv, multiAdv, multiMainC,
multiBioC,multiFlC, multiCvC, multiObsC, multiAssC,multiAdvC,
file = 'multi.RData')
#==============================================================================
#  Section 19:       Run FLBEIA
#==============================================================================
s2 <- FLBEIA(biols = multiBio,       # FLBiols object with 2 FLBiol element for stk1.
SRs = multiSR,        # A list with 1 FLSRSim object for stk1.
BDs = multiBD,        # A list with 1 FLBDSim object for stk2.
fleets = multiFl,        # FLFleets object with on fleet.
covars = multiCv,         # covars not used
indices = NULL,         # indices not used
advice = multiAdv,       # A list with two elements 'TAC' and 'quota.share'
main.ctrl = multiMainC,     # A list with one element to define the start and end of the simulation.
biols.ctrl = multiBioC,      # A list with one element to select the model to simulate the stock dynamics.
fleets.ctrl = multiFlC,       # A list with several elements to select fleet dynamic models and store additional parameters.
covars.ctrl = multiCvC,         # covars control not used
obs.ctrl = multiObsC,      # A list with one element to define how the stock observed ("PerfectObs").
assess.ctrl = multiAssC,      # A list with one element to define how the stock assessment model used ("NoAssessment").
advice.ctrl = multiAdvC)       # A list with one element to define how the TAC advice is obtained ("IcesHCR").
warningsçççç89
warnings()
multiRes <- s2
save(multiRes,file='multiRes.RData')
#==============================================================================
#  Section 20:       Plot
#==============================================================================
# Names of the object returned by FLBEIA
names(s2)
# The default plot for FLBiol defined in FLCore
plot(s2$biols[[1]])
# Create summary data frames (biological, economic, and catch)
s2_sum      <- bioSum(s2)
s2_flt      <- fltSum(s2)
s2_flt      <- fltSum(s2, byyear = FALSE)
s2_fltStk   <- fltStkSum(s2)
# Create several plots and save them in the working directory using 'pdf' format and
# 's2' suffix in the name.
plotFLBiols(s2$biols, pdfnm='s2')
plotFLFleets(s2$fleets,pdfnm='s2')
plotfltStkSum(s2,pdfnm='s2')
plotEco(s2$fleets,pdfnm='s2')
## End(Not run)
args(plotEco)
plotEco(s2,pdfnm='s2')
setwd("C:/Users/aurtizberea/Dropbox/flbeia course/Tutorials/Conditioning/ConditioningOne")
library(knitr)
setwd("C:/Users/aurtizberea/Dropbox/flbeia course/Tutorials/Conditioning/ConditioningOne")
library(FLCore)
library(FLash)
library(FLAssess)
library(FLFleet)
library(FLXSA)
library(FLBEIA)
library(ggplot2)
data(one)
ls()
first.yr          <- 1990
proj.yr           <- 2010
last.yr           <- 2025
yrs <- c(first.yr=first.yr,proj.yr=proj.yr,last.yr=last.yr)
#  Set names, age, dimensions
fls   <- c('fl1')
stks <- c('stk1')
fl1.mets      <- c('met1')
fl1.met1.stks  <- c('stk1')
# all stocks the same
ni           <- 1
it           <- 1:ni
ns             <- 1
# stock stk1
stk1.age.min    <- 1
stk1.age.max    <- 12
stk1.unit       <- 1
#  Data: stk1_n.flq, m, spwn, fec, wt
#stock stk1
stk1_n.flq     <- iter(as.FLQuant(read.csv(file = 'data/stk1_n.csv')),it)
stk1_m.flq     <- iter(as.FLQuant(read.csv(file = 'data/stk1_m.csv')),it)
stk1_spwn.flq  <- iter(as.FLQuant(read.csv(file = 'data/stk1_spwn.csv')),it)
stk1_fec.flq   <- iter(as.FLQuant(read.csv(file = 'data/stk1_fec.csv')),it)
stk1_wt.flq    <- iter(as.FLQuant(read.csv(file = 'data/stk1_wt.csv')),it)
stk1_mat.flq   <- stk1_fec.flq
stk1_mat.flq[] <- 1
stk1_range.min       <- 1
stk1_range.max       <- 12
stk1_range.plusgroup <- 12
stk1_range.minyear   <- 1990
stk1_range.minfbar   <- 4
stk1_range.maxfbar   <- 9
# Projection biols: weight,fecundity,mortality and spawning
stk1_biol.proj.avg.yrs  <- c(2007:2009)
# Create the object
stks.data <- list(stk1=ls(pattern="^stk1"))
biols    <- create.biols.data(yrs,ns,ni,stks.data)
create.biols.data
debug(create.biols.data)
biols    <- create.biols.data(yrs,ns,ni,stks.data)
first.yr
stk.flqa
stk.flqa
debug(create.biols.data)
biols    <- create.biols.data(yrs,ns,ni,stks.data)
proj.yrs
undebug(create.biols.data)
biols    <- create.biols.data(yrs,ns,ni,stks.data)
names(biols)
slotNames(biols[["stk1"]])
biols[[1]]@n
biols[[1]]@n[] <- 1
biols[[1]]@n[]
biols[[1]]@w
biols[[1]]@wt
biols[[1]]@range
plotFLBiols(biols,pdfnm='s0')
#stock stk1
stk1_n.flq     <- iter(as.FLQuant(read.csv(file = 'data/stk1_n.csv')),it)
stk1_m.flq     <- iter(as.FLQuant(read.csv(file = 'data/stk1_m.csv')),it)
stk1_spwn.flq  <- iter(as.FLQuant(read.csv(file = 'data/stk1_spwn.csv')),it)
stk1_fec.flq   <- iter(as.FLQuant(read.csv(file = 'data/stk1_fec.csv')),it)
stk1_wt.flq    <- iter(as.FLQuant(read.csv(file = 'data/stk1_wt.csv')),it)
stk1_mat.flq   <- stk1_fec.flq
stk1_mat.flq[] <- 1
stk1_range.min       <- 1
stk1_range.max       <- 12
stk1_range.plusgroup <- 12
stk1_range.minyear   <- 1990
stk1_range.minfbar   <- 4
stk1_range.maxfbar   <- 9
# Projection biols: weight,fecundity,mortality and spawning
stk1_biol.proj.avg.yrs  <- c(2007:2009)
# Create the object
stks.data <- list(stk1=ls(pattern="^stk1"))
biols    <- create.biols.data(yrs,ns,ni,stks.data)
plotFLBiols(biols,pdfnm='s0')
stk1_sr.model        <- 'bevholtAR1'
stk1_params.n        <- 3
stk1_params.array    <- xtabs2(data~param+year+season+iter,
data=read.csv(file = 'data/stk1_params.csv'),
exclude=NULL,na.action=na.pass)[,,,it,drop=F]
stk1_params.name     <- c('a','b','c')
stk1_rec.flq         <- iter(as.FLQuant(read.csv(file = 'data/stk1_rec.csv')),it)
stk1_ssb.flq         <- iter(as.FLQuant(read.csv(file = 'data/stk1_ssb.csv')),it)
stk1_uncertainty.flq <- iter(as.FLQuant(read.csv(file = 'data/stk1_uncertainty.csv')),it)
stk1_proportion.flq  <- iter(as.FLQuant(read.csv(file = 'data/stk1_proportion.csv')),it)
stk1_prop.avg.yrs    <- ac(2006:2008)
stk1_timelag.matrix  <- matrix(c(1,1),nrow=2,ncol=1, dimnames = list(c('year', 'season'),'all'))
#              FLBEIA input object: SRs
stks.data <- list(stk1=ls(pattern="^stk1"))
SRs      <- create.SRs.data(yrs,ns,ni,stks.data)
## ----echo=TRUE, eval=TRUE------------------------------------------------
stk1_sr.model        <- 'bevholtAR1'
stk1_params.n        <- 3
stk1_params.array    <- xtabs2(data~param+year+season+iter,
data=read.csv(file = 'data/stk1_params.csv'),
exclude=NULL,na.action=na.pass)[,,,it,drop=F]
stk1_params.name     <- c('a','b','c')
stk1_rec.flq         <- iter(as.FLQuant(read.csv(file = 'data/stk1_rec.csv')),it)
stk1_ssb.flq         <- iter(as.FLQuant(read.csv(file = 'data/stk1_ssb.csv')),it)
stk1_uncertainty.flq <- iter(as.FLQuant(read.csv(file = 'data/stk1_uncertainty.csv')),it)
stk1_proportion.flq  <- iter(as.FLQuant(read.csv(file = 'data/stk1_proportion.csv')),it)
stk1_prop.avg.yrs    <- ac(2006:2008)
stk1_timelag.matrix  <- matrix(c(1,1),nrow=2,ncol=1, dimnames = list(c('year', 'season'),'all'))
#              FLBEIA input object: SRs
stks.data <- list(stk1=ls(pattern="^stk1"))
stk1_timelag.matrix
SRs
names(SRs[["stk1"]])
slotNames(SRs[["stk1"]])
data(multi)
multiSR
multiSR[["skt1"]]@proportion
multiSR[["stk1"]]@proportion
multiSR[["stk1"]]@proportion[as.character(2021:2025),]
multiSR[["stk1"]]@proportion[,as.character(2021:2025)]
seasonSums(multiSR[["stk1"]]@proportion[,as.character(2021:2025)])
fl1_effort.flq        <- iter(as.FLQuant(read.csv(file = 'data/fl1_effort.csv')),it)
fl1_capacity.flq      <- iter(as.FLQuant(read.csv(file = 'data/fl1_capacity.csv')),it)
fl1_fcost.flq         <- iter(as.FLQuant(read.csv(file = 'data/fl1_fcost.csv')),it)
fl1_crewshare.flq     <- iter(as.FLQuant(read.csv(file = 'data/fl1_crewshare.csv')),it)
fl1.met1_effshare.flq  <- iter(as.FLQuant(read.csv(file = 'data/fl1.met1_effshare.csv')),it)
fl1.met1.stk1_landings.n.flq <- iter(as.FLQuant(read.csv(file = 'data/fl1.met1.stk1_landings.n.csv')),it)
fl1.met1.stk1_discards.n.flq <- iter(as.FLQuant(read.csv(file = 'data/fl1.met1.stk1_discards.n.csv')),it)
#  fl1.met1.stk1_alpha.flq      <- iter(as.FLQuant(read.csv(file = 'data/fl1.met1.stk1_alpha.csv'))  ,it)
#  fl1.met1.stk1_beta.flq       <- iter(as.FLQuant(read.csv(file = 'data/fl1.met1.stk1_beta.csv'))  ,it)
#  fl1.met1.stk1_catch.q.flq    <- iter(as.FLQuant(read.csv(file = 'data/fl1.met1.stk1_catch.q.csv'))  ,it)
# Projection
#         fleets: fl1
fl1_proj.avg.yrs           <- c(2008:2009)
fl1.met1_proj.avg.yrs       <- c(2008:2009)
fl1.met1.stk1_proj.avg.yrs   <- c(2006:2008)
#              create fleets object
fls.data <- list(fl1=ls(pattern="^fl1"))
fleets   <- create.fleets.data(yrs,ns,ni,fls.data,stks.data)
plotFLFleets(fleets,pdfnm='s0')
names(fleets)
slotNames(fleets[["fl1"]])
slotNames(fleets[["fl1"]]
slotNames(fleets[["fl1"]]@metiers)
slotNames(fleets[["fl1"]]@metiers[["met1"]])
slotNames(fleets[["fl1"]]@metiers[["met1"]]@catches[["stk1"]])
fleets[["fl1"]]@metiers[["met1"]]@catches[["stk1"]]@catch.q
stk1_advice.TAC.flq         <- iter(as.FLQuant(read.csv(file = 'data/stk1_advice.tac.csv')),it)
stk1_advice.quota.share.flq <- iter(as.FLQuant(read.csv(file = 'data/stk1_advice.quota.share.csv')),it)
stk1_advice.avg.yrs         <- c(2006:2008)
#   create advice object
stks.data <- list(stk1=ls(pattern="^stk1"))
advice   <- create.advice.data(yrs,ns,ni,stks.data,fleets)
names(advice)
advice$TAC
advice$quota.share
indices <- NULL
main.ctrl           <- list()
main.ctrl$sim.years <- c(initial = proj.yr, final = last.yr)
main.ctrl
growth.model     <- c('ASPG')
biols.ctrl       <- create.biols.ctrl (stksnames=stks,growth.model=growth.model)
n.fls.stks      <- 1
fls.stksnames   <- 'stk1'
effort.models    <- 'SMFB'
effort.restr.fl1 <- 'stk1'
restriction.fl1  <- 'catch'
catch.models     <- 'CobbDouglasAge'
capital.models   <- 'fixedCapital'
flq.stk1<- FLQuant(dimnames = list(age = 'all', year = first.yr:last.yr, unit = stk1.unit,
season = 1:ns, iter = 1:ni))
fleets.ctrl      <- create.fleets.ctrl(fls=fls,n.fls.stks=n.fls.stks,fls.stksnames=fls.stksnames,
effort.models= effort.models, catch.models=catch.models,
capital.models=capital.models, flq=flq.stk1,
effort.restr.fl1 = effort.restr.fl1, restriction.fl1 = restriction.fl1)
fleets.ctrl$fl1$stk1$discard.TAC.OS  <- FALSE
fleets.ctrl$fl1$restriction <- "landings"
n.fls.stks      <- 1
fls.stksnames   <- 'stk1'
effort.models    <- 'SMFB'
effort.restr.fl1 <- 'stk1'
restriction.fl1  <- 'catch'
catch.models     <- 'CobbDouglasAge'
capital.models   <- 'fixedCapital'
flq.stk1<- FLQuant(dimnames = list(age = 'all', year = first.yr:last.yr, unit = stk1.unit,
season = 1:ns, iter = 1:ni))
fleets.ctrl      <- create.fleets.ctrl(fls=fls,n.fls.stks=n.fls.stks,fls.stksnames=fls.stksnames,
effort.models= effort.models, catch.models=catch.models,
capital.models=capital.models, flq=flq.stk1,
effort.restr.fl1 = effort.restr.fl1, restriction.fl1 = restriction.fl1)
fleets.ctrl$fl1$stk1$discard.TAC.OS  <- FALSE
fleets.ctrl$fl1$restriction <- "landings"
fleets.ctrl$fl1
HCR.models       <- c('IcesHCR')
ref.pts.stk1      <- matrix(rep(c(548.6296271, 768.0814779, 0.1057783),3), 3,ni, dimnames = list(c('Blim', 'Btrigger','Fmsy'), 1:ni))
advice.ctrl      <- create.advice.ctrl(stksnames = stks, HCR.models =  HCR.models,
ref.pts.stk1 = ref.pts.stk1,first.yr=first.yr,last.yr=last.yr)
advice.ctrl[['stk1']][['sr']]            <- list()
advice.ctrl[['stk1']][['sr']][['model']] <- 'geomean'
advice.ctrl[['stk1']][['sr']][['years']] <- c(y.rm = 2, num.years = 10)
advice.ctrl$stk1$AdvCatch <- rep(TRUE,length(first.yr:last.yr))   #TRUE advice in catches, FALSE advice in landings
names(advice.ctrl$stk1$AdvCatch) <- as.character((first.yr:last.yr))
assess.models    <- 'NoAssessment'
assess.ctrl <- create.assess.ctrl(stksnames = stks, assess.models = assess.models)
assess.ctrl[['stk1']]$work_w_Iter   <- TRUE
stkObs.models<- "perfectObs"
flq.stk1<- FLQuant(dimnames = list(age = 'all', year = first.yr:last.yr, unit = stk1.unit,
season = 1:ns, iter = 1:ni))
obs.ctrl        <- create.obs.ctrl(stksnames = stks,  stkObs.models = stkObs.models,flq.stk1 = flq.stk1)
covars.ctrl      <- NULL
BDs       <- NULL
covars    <- NULL
save(biols, SRs,BDs, fleets, covars,
indices, advice, main.ctrl,
biols.ctrl, fleets.ctrl,
covars.ctrl, obs.ctrl,
assess.ctrl, advice.ctrl, file="input_S0_1it.RData")
s0 <- FLBEIA(biols = biols, SRs = SRs, BDs = BDs, fleets=fleets, covars = covars,
indices = indices, advice = advice, main.ctrl = main.ctrl,
biols.ctrl = biols.ctrl, fleets.ctrl = fleets.ctrl,
covars.ctrl = covars.ctrl, obs.ctrl = obs.ctrl,
assess.ctrl = assess.ctrl, advice.ctrl = advice.ctrl)
names(s0)
names(s0$biols)
s0$biols[[1]]@
n
plotFLBiols(s0$biols,pdfnm='s0_res')
plotFLFleets(s0$fleets,pdfnm='s0_res')
plotfltStkSum(s0,pdfnm='s0_res')
plotEco(s0,pdfnm='s0_res')
